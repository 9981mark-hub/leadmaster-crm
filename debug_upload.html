<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <title>Google Apps Script Upload Debugger</title>
    <style>
        body {
            font-family: sans-serif;
            padding: 20px;
        }

        .box {
            border: 1px solid #ccc;
            padding: 20px;
            margin-top: 20px;
            border-radius: 8px;
        }

        button {
            padding: 10px 20px;
            background: #007bff;
            color: white;
            border: none;
            cursor: pointer;
        }

        button:hover {
            background: #0056b3;
        }

        pre {
            background: #f4f4f4;
            padding: 10px;
            overflow-x: auto;
        }

        .error {
            color: red;
            font-weight: bold;
        }

        .success {
            color: green;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <h1>ğŸ“‚ íŒŒì¼ ì—…ë¡œë“œ ë””ë²„ê¹…</h1>
    <p>ì•„ë˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ í…ŒìŠ¤íŠ¸ìš© í…ìŠ¤íŠ¸ íŒŒì¼ì„ ì „ì†¡í•˜ê³ , ê²°ê³¼ì°½ì— ëœ¨ëŠ” ë©”ì‹œì§€ë¥¼ ì•Œë ¤ì£¼ì„¸ìš”.</p>

    <div class="box">
        <button id="btnUpload" onclick="testUpload()">í…ŒìŠ¤íŠ¸ íŒŒì¼ ì—…ë¡œë“œ ì‹œì‘</button>
        <div id="status" style="margin-top: 10px;">ëŒ€ê¸° ì¤‘...</div>
    </div>

    <div class="box">
        <h3>ğŸ“„ ì„œë²„ ì‘ë‹µ ê²°ê³¼ (ì´ ë‚´ìš©ì„ ì•Œë ¤ì£¼ì„¸ìš”)</h3>
        <pre id="console">ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</pre>
    </div>

    <script>
        // ìµœì¢… ë°°í¬ëœ URL (Step 685)
        const URL = "https://script.google.com/macros/s/AKfycbx3goZ3k9nBvs3EMUq5nAglTv_-JKa1cY7h8wfx1AncxRTP7egaX814GCgIyJSiHgXkpA/exec";

        async function testUpload() {
            const btn = document.getElementById('btnUpload');
            const status = document.getElementById('status');
            const consoleOut = document.getElementById('console');

            btn.disabled = true;
            status.innerText = "ì—…ë¡œë“œ ì¤‘... (ì„œë²„ ì—°ê²° ì‹œë„)";
            consoleOut.innerText = "ìš”ì²­ ë³´ë‚´ëŠ” ì¤‘...";

            try {
                // ê°„ë‹¨í•œ í…ìŠ¤íŠ¸ ë°ì´í„° (Base64)
                const dummyData = {
                    target: 'upload',
                    filename: 'debug_test.txt',
                    mimeType: 'text/plain',
                    data: 'SGVsbG8gV29ybGQh' // "Hello World!"
                };

                // fetch ìš”ì²­ (no-cors ì•„ë‹˜)
                const response = await fetch(URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain;charset=utf-8' }, // GASëŠ” text/plain ì„ í˜¸
                    body: JSON.stringify(dummyData)
                });

                const text = await response.text();

                try {
                    const json = JSON.parse(text);
                    if (json.status === 'success') {
                        status.innerHTML = "<span class='success'>âœ… ì„±ê³µ!</span>";
                        consoleOut.innerHTML = JSON.stringify(json, null, 2);
                    } else {
                        status.innerHTML = "<span class='error'>âŒ ì‹¤íŒ¨ (ì„œë²„ ì—ëŸ¬)</span>";
                        consoleOut.innerHTML = "ì—ëŸ¬ ë©”ì‹œì§€:\n" + JSON.stringify(json, null, 2);
                    }
                } catch (e) {
                    status.innerHTML = "<span class='error'>âš ï¸ ì‘ë‹µ íŒŒì‹± ì‹¤íŒ¨</span>";
                    consoleOut.innerText = "ì„œë²„ê°€ JSONì´ ì•„ë‹Œ HTMLì„ ë³´ëƒˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤:\n\n" + text;
                }

            } catch (err) {
                status.innerHTML = "<span class='error'>ğŸš« ë„¤íŠ¸ì›Œí¬/CORS ì—ëŸ¬</span>";
                consoleOut.innerText = "ë¸Œë¼ìš°ì € ì°¨ë‹¨ ë˜ëŠ” ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜:\n" + err.toString();
            } finally {
                btn.disabled = false;
            }
        }
    </script>
</body>

</html>