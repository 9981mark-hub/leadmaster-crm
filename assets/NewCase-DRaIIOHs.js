import{w as Q,x as X,e as Z,r as f,j as s,C as ee,J as se,H as te,y as ae,F as ne,R as le,A as re,z as oe,B as ie,o as de,d as ce,b as me,D as ue,E as xe,M as be,k as he,G as ge}from"./index-CBb2znoQ.js";import{n as pe}from"./utils-ayI8SNpN.js";import{B as fe}from"./building-Cah-jPiY.js";import{T as _,P as R}from"./trash-2-BPf2JRJt.js";import{C as je,a as ye}from"./chevron-right-BL08l1LG.js";import{S as Ne}from"./save-DchViW9E.js";const i=({label:N,value:b,onChange:m,onBlur:g,type:o="text",placeholder:u="",suffix:j=""})=>{const S=o==="number"&&b===0?"":b;return s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:N}),s.jsxs("div",{className:"relative",children:[s.jsx("input",{type:o,className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:outline-none",value:S,onChange:v=>m(o==="number"?Number(v.target.value)||0:v.target.value),onBlur:g,placeholder:u}),j&&s.jsx("span",{className:"absolute right-3 top-2 text-gray-500 text-sm",children:j})]})]})},x=({label:N,value:b,onChange:m,options:g,isMulti:o=!1})=>s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:N}),s.jsx("div",{className:"flex gap-2 flex-wrap",children:g.map(u=>{const j=o?b==null?void 0:b.includes(u):b===u;return s.jsx("button",{type:"button",onClick:()=>m(u),className:`px-3 py-2 text-sm rounded-md border ${j?"bg-blue-600 text-white border-blue-600":"bg-white text-gray-600 border-gray-300 hover:bg-gray-50"}`,children:u},u)})})]});function Ie(){var L,P,k,M,D,E,H,O;const N=Q(),[b]=X(),m=b.get("leadId"),{showToast:g}=Z(),[o,u]=f.useState(1),[j,S]=f.useState([]),[v,z]=f.useState([]),[t,w]=f.useState({partnerId:"",caseType:"개인회생",inboundPath:"",customerName:"",phone:"010",birth:"",gender:"남",region:"",jobTypes:["직장인"],insurance4:"미가입",maritalStatus:"미혼",childrenCount:0,incomeDetails:{},incomeNet:0,loanMonthlyPay:0,housingType:"월세",housingDetail:"빌라",deposit:0,rent:0,depositLoanAmount:0,rentContractor:"본인",ownHousePrice:0,ownHouseLoan:0,ownHouseOwner:"본인",freeHousingOwner:"부모님",assets:[],creditLoan:[],creditCardUse:"미사용",creditCardAmount:0,collateralLoanMemo:"",historyType:"없음",historyMemo:"",specialMemo:""}),[l,y]=f.useState({owner:"본인",type:"자동차",amount:0,loanAmount:0,desc:""}),[p,T]=f.useState({amount:0,desc:""});f.useEffect(()=>{(async()=>{const[n,r,h]=await Promise.all([de(),ce(),m?me():Promise.resolve([])]);if(S(n),z(r),r.length>0&&!t.partnerId&&w(d=>({...d,partnerId:r[0].partnerId})),m){const d=h.find(c=>c.caseId===m);d&&w(c=>({...c,...d,jobTypes:d.jobTypes&&d.jobTypes.length>0?d.jobTypes:["직장인"]}))}})()},[m]);const a=(e,n)=>{e==="phone"&&(n=ue(n)),w(r=>({...r,[e]:n}))},A=(e,n)=>{const r={...t.incomeDetails,[e]:n},h=Object.values(r).reduce((d,c)=>d+(c||0),0);w(d=>({...d,incomeDetails:r,incomeNet:h}))},$=e=>{const n=t.jobTypes||[],r=n.includes(e)?n.filter(c=>c!==e):[...n,e],h={...t.incomeDetails};e==="직장인"&&!r.includes("직장인")&&delete h.salary,["개인사업자","법인사업자"].includes(e)&&!r.some(c=>["개인사업자","법인사업자"].includes(c))&&delete h.business,e==="프리랜서"&&!r.includes("프리랜서")&&delete h.freelance;const d=Object.values(h).reduce((c,K)=>c+(K||0),0);w(c=>({...c,jobTypes:r,incomeDetails:h,incomeNet:d}))},B=()=>{const e=pe(t.birth);e!==t.birth&&a("birth",e)},F=()=>{if(!l.type)return;const e={id:Date.now().toString(),owner:l.owner||"본인",type:l.type||"기타",amount:l.amount||0,loanAmount:l.loanAmount||0,desc:l.desc||""};a("assets",[...t.assets,e]),y({owner:"본인",type:"자동차",amount:0,loanAmount:0,desc:""})},U=()=>{if(!p.amount||!p.desc){g("대출금액과 내용을 모두 입력해주세요.","error");return}const e={id:Date.now().toString(),amount:p.amount||0,desc:p.desc||""};a("creditLoan",[...t.creditLoan||[],e]),T({amount:0,desc:""})},Y=e=>{a("assets",t.assets.filter(n=>n.id!==e))},G=e=>{a("creditLoan",t.creditLoan.filter(n=>n.id!==e))},J=()=>u(e=>e+1),V=()=>u(e=>e-1),W=async()=>{try{const e={...t};e.specialMemo&&typeof e.specialMemo=="string"&&e.specialMemo.trim()?e.specialMemo=[{id:Date.now().toString(),createdAt:new Date().toISOString(),content:e.specialMemo.trim()}]:Array.isArray(e.specialMemo)||(e.specialMemo=[]);let n;if(m)n=await xe(m,{...e,isNew:!1,status:e.status==="신규접수"?"상담진행":e.status}),g("케이스가 정식 등록되었습니다.");else{const r={...e,managerName:be,isNew:!1};n=await he(r),g("신규 케이스가 등록되었습니다.")}n!=null&&n.caseId&&ge(n.caseId),N(`/case/${n.caseId}`)}catch(e){console.error(e),g("저장 중 오류가 발생했습니다.","error")}},q=()=>{const e=[];return t.depositLoanAmount>0&&e.push(`보증금 대출 ${t.depositLoanAmount}만원`),t.ownHouseLoan>0&&e.push(`집 담보 대출 ${t.ownHouseLoan}만원`),t.assets.forEach(n=>{n.loanAmount>0&&e.push(`${n.type} 담보 ${n.loanAmount}만원`)}),e.length>0?e.join(" + "):"없음"},I=v.find(e=>e.partnerId===t.partnerId),C=e=>I?I.requiredFields.includes(e):!0;return s.jsxs("div",{className:"max-w-xl mx-auto bg-white p-6 rounded-xl shadow-sm border border-gray-100",children:[s.jsxs("div",{className:"mb-6",children:[s.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"신규 상담 입력"}),s.jsx("div",{className:"flex gap-1 mt-2",children:[1,2,3,4,5].map(e=>s.jsx("div",{className:`h-1 flex-1 rounded-full ${e<=o?"bg-blue-600":"bg-gray-200"}`},e))})]}),s.jsxs("div",{className:"min-h-[300px]",children:[o===1&&s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold mb-4 text-blue-600",children:"1. 기본 정보"}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"거래처 (법률사무소)"}),s.jsxs("div",{className:"relative",children:[s.jsx("select",{className:"w-full p-2 pl-8 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:outline-none bg-blue-50 text-blue-900 font-bold",value:t.partnerId,onChange:e=>a("partnerId",e.target.value),children:v.map(e=>s.jsx("option",{value:e.partnerId,children:e.name},e.partnerId))}),s.jsx(fe,{className:"absolute left-2.5 top-2.5 text-blue-500",size:18})]})]}),s.jsx(x,{label:"사건 유형",value:t.caseType,onChange:e=>a("caseType",e),options:ee}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"유입 경로"}),s.jsxs("select",{className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:outline-none",value:t.inboundPath,onChange:e=>a("inboundPath",e.target.value),children:[s.jsx("option",{value:"",children:"선택하세요"}),j.map(e=>s.jsx("option",{value:e,children:e},e))]})]}),s.jsx("hr",{className:"my-4 border-gray-100"}),t.preInfo&&s.jsxs("div",{className:"mb-4 animate-fade-in",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"사전 고객 정보 (리드 수집 정보)"}),s.jsx("div",{className:"w-full p-3 border border-indigo-100 rounded-lg text-sm bg-indigo-50 text-gray-700 whitespace-pre-wrap leading-relaxed shadow-sm",children:t.preInfo.split(/\s\/\s|\n/).filter(e=>{const n=e.toLowerCase();return!n.includes("[referrer]")&&!n.includes("[marketing_consent]")&&!n.includes("[third_party_consent]")&&!n.includes("[user_agent]")&&e.trim()!==""}).join(`
`)||s.jsx("span",{className:"text-gray-400 italic",children:"표시할 추가 정보가 없습니다. (기술 정보 제외됨)"})})]}),s.jsx(i,{label:"고객명",value:t.customerName,onChange:e=>a("customerName",e)}),s.jsx(i,{label:"연락처",value:t.phone,onChange:e=>a("phone",e),placeholder:"01012345678"}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsx(i,{label:"출생년도 (2자리)",value:t.birth,onChange:e=>a("birth",e),onBlur:B,placeholder:"예: 77",suffix:t.birth.length===4?"년생":""}),s.jsx(x,{label:"성별",value:t.gender,onChange:e=>a("gender",e),options:["남","여"]})]})]}),o===2&&s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold mb-4 text-blue-600",children:"2. 직업/소득/가족"}),s.jsx(x,{label:"직업 (복수선택 가능)",value:t.jobTypes,onChange:$,options:se,isMulti:!0}),((L=t.jobTypes)==null?void 0:L.includes("직장인"))&&s.jsx(i,{label:"직장인 월수입",value:(P=t.incomeDetails)==null?void 0:P.salary,onChange:e=>A("salary",e),type:"number",suffix:"만원"}),(((k=t.jobTypes)==null?void 0:k.includes("개인사업자"))||((M=t.jobTypes)==null?void 0:M.includes("법인사업자")))&&s.jsx(i,{label:"사업자 월수입",value:(D=t.incomeDetails)==null?void 0:D.business,onChange:e=>A("business",e),type:"number",suffix:"만원"}),((E=t.jobTypes)==null?void 0:E.includes("프리랜서"))&&s.jsx(i,{label:"프리랜서 월수입",value:(H=t.incomeDetails)==null?void 0:H.freelance,onChange:e=>A("freelance",e),type:"number",suffix:"만원"}),s.jsx(x,{label:"4대보험",value:t.insurance4,onChange:e=>a("insurance4",e),options:["가입","미가입"]}),s.jsx(x,{label:"결혼여부",value:t.maritalStatus,onChange:e=>a("maritalStatus",e),options:["미혼","기혼","이혼"]}),["기혼","이혼"].includes(t.maritalStatus)&&C("childrenCount")&&s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"미성년 자녀 수"}),s.jsx("div",{className:"flex gap-2 flex-wrap",children:[0,1,2,3,4,5,6,7].map(e=>s.jsxs("button",{type:"button",onClick:()=>a("childrenCount",e),className:`px-3 py-2 border rounded-md text-sm ${t.childrenCount===e?"bg-blue-600 text-white border-blue-600":"bg-white text-gray-700 hover:bg-gray-50"}`,children:[e,"명"]},e))})]})]}),o===3&&s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold mb-4 text-blue-600",children:"3. 주거"}),s.jsx(x,{label:"거주형태",value:t.housingType,onChange:e=>a("housingType",e),options:te}),s.jsx(x,{label:"주거타입",value:t.housingDetail,onChange:e=>a("housingDetail",e),options:ae}),t.housingType==="자가"?s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsx(i,{label:"집 시세",value:t.ownHousePrice,onChange:e=>a("ownHousePrice",e),type:"number",suffix:"만원"}),s.jsx(i,{label:"집 담보 대출",value:t.ownHouseLoan,onChange:e=>a("ownHouseLoan",e),type:"number",suffix:"만원"})]}),s.jsx(x,{label:"집 명의자",value:t.ownHouseOwner,onChange:e=>a("ownHouseOwner",e),options:["본인","배우자"]})]}):t.housingType==="무상거주"?s.jsx(s.Fragment,{children:s.jsx(x,{label:"집 명의자",value:t.freeHousingOwner,onChange:e=>a("freeHousingOwner",e),options:ne})}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsx(i,{label:"보증금",value:t.deposit,onChange:e=>a("deposit",e),type:"number",suffix:"만원"}),C("depositLoan")&&s.jsx(i,{label:"보증금 대출",value:t.depositLoanAmount,onChange:e=>a("depositLoanAmount",e),type:"number",suffix:"만원"})]}),s.jsx(i,{label:"월세",value:t.rent,onChange:e=>a("rent",e),type:"number",suffix:"만원"}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"임대차 계약인"}),s.jsx("div",{className:"flex gap-2",children:le.map(e=>s.jsx("button",{type:"button",onClick:()=>a("rentContractor",e),className:`flex-1 py-2 text-sm rounded-md border ${t.rentContractor===e?"bg-blue-600 text-white border-blue-600":"bg-white text-gray-600 border-gray-300 hover:bg-gray-50"}`,children:e},e))})]})]}),s.jsx(i,{label:"거주지역",value:t.region,onChange:e=>a("region",e),placeholder:"예: 서울 강남"})]}),o===4&&s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold mb-4 text-blue-600",children:"4. 자산/부채"}),C("assets")&&s.jsxs("div",{className:"mb-6 bg-blue-50 p-4 rounded-lg border border-blue-200",children:[s.jsx("h4",{className:"font-bold text-gray-700 mb-2 text-sm",children:"자산 목록 (본인/배우자 포함)"}),s.jsxs("div",{className:"space-y-2 mb-3",children:[t.assets.length===0&&s.jsx("p",{className:"text-xs text-gray-400 text-center py-2",children:"등록된 자산이 없습니다."}),t.assets.map(e=>s.jsxs("div",{className:"bg-white p-2 rounded border flex justify-between items-center text-sm",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("span",{className:"font-bold text-blue-600 mr-2",children:["[",e.owner,"]"]}),s.jsx("span",{className:"font-semibold mr-2",children:e.type}),s.jsxs("span",{className:"text-gray-800 mr-2",children:["시세 ",e.amount>0?`${e.amount.toLocaleString()}만원`:"0원"]}),e.loanAmount>0&&s.jsxs("span",{className:"text-red-500 mr-2",children:["담보 ",e.loanAmount.toLocaleString(),"만원"]})]}),s.jsx("button",{type:"button",onClick:()=>Y(e.id),className:"text-red-500 p-1",children:s.jsx(_,{size:16})})]},e.id))]}),s.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-2",children:[s.jsx("select",{className:"p-2 border rounded text-sm bg-white",value:l.owner,onChange:e=>y({...l,owner:e.target.value}),children:re.map(e=>s.jsx("option",{value:e,children:e},e))}),s.jsx("select",{className:"p-2 border rounded text-sm bg-white",value:l.type,onChange:e=>y({...l,type:e.target.value}),children:oe.map(e=>s.jsx("option",{value:e,children:e},e))})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-2",children:[s.jsx("input",{type:"number",placeholder:"시세 (만원)",className:"w-full p-2 border rounded text-sm",value:l.amount||"",onChange:e=>y({...l,amount:Number(e.target.value)})}),s.jsx("input",{type:"number",placeholder:"담보대출 (만원)",className:"w-full p-2 border rounded text-sm",value:l.loanAmount||"",onChange:e=>y({...l,loanAmount:Number(e.target.value)})})]}),s.jsxs("div",{className:"flex gap-2 mb-2",children:[s.jsx("input",{type:"text",placeholder:"상세 내용 (예: 차종 등)",className:"flex-1 p-2 border rounded text-sm",value:l.desc||"",onChange:e=>y({...l,desc:e.target.value})}),s.jsxs("button",{type:"button",onClick:F,className:"w-24 bg-blue-600 text-white rounded text-sm font-bold flex justify-center items-center hover:bg-blue-700",children:[s.jsx(R,{size:16,className:"mr-1"})," 추가"]})]})]}),s.jsxs("div",{className:"mb-6 bg-pink-50 p-4 rounded-lg border border-pink-200",children:[s.jsx("h4",{className:"font-bold text-gray-700 mb-2 text-sm",children:"신용대출 목록"}),s.jsxs("div",{className:"space-y-2 mb-3",children:[(t.creditLoan||[]).length===0&&s.jsx("p",{className:"text-xs text-gray-400 text-center py-2",children:"등록된 신용대출이 없습니다."}),(O=t.creditLoan)==null?void 0:O.map(e=>s.jsxs("div",{className:"bg-white p-2 rounded border flex justify-between items-center text-sm",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("span",{className:"font-semibold mr-2",children:e.desc}),s.jsxs("span",{className:"text-gray-800",children:[e.amount.toLocaleString(),"만원"]})]}),s.jsx("button",{type:"button",onClick:()=>G(e.id),className:"text-red-500 p-1",children:s.jsx(_,{size:16})})]},e.id))]}),s.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-2",children:[s.jsx("input",{type:"text",placeholder:"대출 내용 (예: 햇살론)",className:"w-full p-2 border rounded text-sm col-span-2",value:p.desc||"",onChange:e=>T({...p,desc:e.target.value})}),s.jsx("input",{type:"number",placeholder:"금액 (만원)",className:"w-full p-2 border rounded text-sm",value:p.amount||"",onChange:e=>T({...p,amount:Number(e.target.value)})}),s.jsxs("button",{type:"button",onClick:U,className:"w-full py-2 bg-blue-600 text-white rounded text-sm font-bold flex justify-center items-center hover:bg-blue-700",children:[s.jsx(R,{size:16,className:"mr-1"})," 신용대출 추가"]})]})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"담보 대출 내용 (자동 집계 + 추가)"}),s.jsxs("div",{className:"bg-gray-50 p-2 rounded text-sm text-blue-800 font-medium mb-1",children:["자동 집계: ",q()]}),s.jsx("input",{type:"text",className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:outline-none",value:t.collateralLoanMemo,onChange:e=>a("collateralLoanMemo",e.target.value),placeholder:"추가로 작성할 담보 대출 내용"})]}),s.jsx("div",{className:"grid grid-cols-2 gap-4",children:C("creditCard")&&s.jsxs(s.Fragment,{children:[s.jsx(x,{label:"신용카드 사용",value:t.creditCardUse,onChange:e=>a("creditCardUse",e),options:["사용","미사용"]}),t.creditCardUse==="사용"&&s.jsx(i,{label:"사용 금액",value:t.creditCardAmount,onChange:e=>a("creditCardAmount",e),type:"number",suffix:"만원"})]})}),s.jsx(i,{label:"월 대출납입",value:t.loanMonthlyPay,onChange:e=>a("loanMonthlyPay",e),type:"number",suffix:"만원"}),C("history")&&s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"개인회생/파산/회복 이력"}),s.jsx("div",{className:"flex gap-2 mb-2 flex-wrap",children:ie.map(e=>s.jsx("button",{type:"button",onClick:()=>a("historyType",e),className:`px-3 py-2 text-sm rounded-md border ${t.historyType===e?"bg-blue-600 text-white border-blue-600":"bg-white text-gray-600 border-gray-300 hover:bg-gray-50"}`,children:e},e))}),t.historyType&&t.historyType!=="없음"&&s.jsx("textarea",{className:"w-full p-2 border border-gray-300 rounded-md h-20 text-sm focus:ring-2 focus:ring-blue-500 focus:outline-none",value:t.historyMemo,onChange:e=>a("historyMemo",e.target.value),placeholder:"이력 상세 내용을 입력하세요."})]})]}),o===5&&s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold mb-4 text-blue-600",children:"5. 마무리"}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"상담 특이사항"}),s.jsx("textarea",{className:"w-full p-2 border border-gray-300 rounded-md h-32 text-sm focus:ring-2 focus:ring-blue-500 focus:outline-none",value:t.specialMemo,onChange:e=>a("specialMemo",e.target.value),placeholder:"상담 내용을 자유롭게 기록하세요."})]}),s.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:s.jsx("p",{className:"text-sm text-blue-800 font-medium text-center",children:"작성을 완료하고 케이스를 생성합니다."})})]})]}),s.jsxs("div",{className:"flex justify-between mt-6 pt-4 border-t border-gray-100",children:[o>1?s.jsxs("button",{onClick:V,className:"flex items-center text-gray-600 font-medium px-4 py-2 hover:bg-gray-100 rounded-lg",children:[s.jsx(je,{size:18})," 이전"]}):s.jsx("div",{}),o<5?s.jsxs("button",{onClick:J,className:"flex items-center bg-blue-600 text-white px-6 py-2 rounded-lg font-medium hover:bg-blue-700",children:["다음 ",s.jsx(ye,{size:18})]}):s.jsxs("button",{onClick:W,className:"flex items-center bg-green-600 text-white px-6 py-2 rounded-lg font-medium hover:bg-green-700",children:[s.jsx(Ne,{size:18,className:"mr-2"})," 저장하기"]})]})]})}export{Ie as default};
