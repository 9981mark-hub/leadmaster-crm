import{c as ut,n as Ut,a6 as Vt,a as Kt,a7 as et,a8 as gt,a9 as bt,r as k,j as e,f as je,s as Zt,aa as Gt,X as Xt,g as qt,ab as Ne,ac as Jt,ad as Qt,ae as es,b as tt,d as ts,af as ss,ag as Ee,ah as Me,a1 as ve,a0 as st,ai as as,aj as rs,ak as Z,al as ns,am as ls,an as os}from"./index.LVfBQ48P.js";import{q as at,a as ds,i as rt,m as nt,r as lt}from"./utils.DvbHqMrd.js";import{M as ot}from"./Modal._vR9srQD.js";import{C as yt}from"./chevron-left.By06XTTN.js";import{C as ft}from"./chevron-right.B1D_sXcV.js";import{a as is,b as cs,s as xs,e as ms,R as Oe,B as dt,C as it,X as ct,Y as xt,T as He,L as ps,c as We,P as hs,d as us,f as gs}from"./PieChart.nlgWJAww.js";import{e as bs,i as ys}from"./isSameMonth.GytKs0EU.js";import{u as Re,w as fs}from"./xlsx.BBWTpfDg.js";import{B as js}from"./building.0vefzCzy.js";import{C as Ns}from"./calendar.ZBaYPaks.js";import{F as vs,S as ws}from"./search.DZhDwMVv.js";import{C as Is}from"./check.CFZ8YfeI.js";import{C as Ss}from"./copy.BeiRGQHR.js";import{P as mt,T as pt}from"./trash-2.CreIw_Ne.js";import{L as Cs}from"./Line.BMhi6A5q.js";import{D as Ds}from"./download.BjJF-Rhc.js";import"./index.B80icz7v.js";import"./tiny-invariant.CXE27_2I.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ks=[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]],As=ut("credit-card",ks);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ls=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],Ts=ut("refresh-cw",Ls);function ze(i,o,m){const[x,y]=Ut(m==null?void 0:m.in,i,o),p=ht(x,y),L=Math.abs(Vt(x,y));x.setDate(x.getDate()-p*L);const I=+(ht(x,y)===-p),P=p*(L-I);return P===0?0:P}function ht(i,o){const m=i.getFullYear()-o.getFullYear()||i.getMonth()-o.getMonth()||i.getDate()-o.getDate()||i.getHours()-o.getHours()||i.getMinutes()-o.getMinutes()||i.getSeconds()-o.getSeconds()||i.getMilliseconds()-o.getMilliseconds();return m<0?-1:m>0?1:m}function we(i,o){const m=()=>Kt(o==null?void 0:o.in,NaN),y=Es(i);let p;if(y.date){const N=Ms(y.date,2);p=Os(N.restDateString,N.year)}if(!p||isNaN(+p))return m();const L=+p;let I=0,P;if(y.time&&(I=Hs(y.time),isNaN(I)))return m();if(y.timezone){if(P=Ws(y.timezone),isNaN(P))return m()}else{const N=new Date(L+I),G=et(0,o==null?void 0:o.in);return G.setFullYear(N.getUTCFullYear(),N.getUTCMonth(),N.getUTCDate()),G.setHours(N.getUTCHours(),N.getUTCMinutes(),N.getUTCSeconds(),N.getUTCMilliseconds()),G}return et(L+I+P,o==null?void 0:o.in)}const Ie={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},Fs=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,Ps=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,$s=/^([+-])(\d{2})(?::?(\d{2}))?$/;function Es(i){const o={},m=i.split(Ie.dateTimeDelimiter);let x;if(m.length>2)return o;if(/:/.test(m[0])?x=m[0]:(o.date=m[0],x=m[1],Ie.timeZoneDelimiter.test(o.date)&&(o.date=i.split(Ie.timeZoneDelimiter)[0],x=i.substr(o.date.length,i.length))),x){const y=Ie.timezone.exec(x);y?(o.time=x.replace(y[1],""),o.timezone=y[1]):o.time=x}return o}function Ms(i,o){const m=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+o)+"})|(\\d{2}|[+-]\\d{"+(2+o)+"})$)"),x=i.match(m);if(!x)return{year:NaN,restDateString:""};const y=x[1]?parseInt(x[1]):null,p=x[2]?parseInt(x[2]):null;return{year:p===null?y:p*100,restDateString:i.slice((x[1]||x[2]).length)}}function Os(i,o){if(o===null)return new Date(NaN);const m=i.match(Fs);if(!m)return new Date(NaN);const x=!!m[4],y=xe(m[1]),p=xe(m[2])-1,L=xe(m[3]),I=xe(m[4]),P=xe(m[5])-1;if(x)return Ys(o,I,P)?Rs(o,I,P):new Date(NaN);{const N=new Date(0);return!Bs(o,p,L)||!_s(o,y)?new Date(NaN):(N.setUTCFullYear(o,p,Math.max(y,L)),N)}}function xe(i){return i?parseInt(i):1}function Hs(i){const o=i.match(Ps);if(!o)return NaN;const m=Be(o[1]),x=Be(o[2]),y=Be(o[3]);return Us(m,x,y)?m*gt+x*bt+y*1e3:NaN}function Be(i){return i&&parseFloat(i.replace(",","."))||0}function Ws(i){if(i==="Z")return 0;const o=i.match($s);if(!o)return 0;const m=o[1]==="+"?-1:1,x=parseInt(o[2]),y=o[3]&&parseInt(o[3])||0;return Vs(x,y)?m*(x*gt+y*bt):NaN}function Rs(i,o,m){const x=new Date(0);x.setUTCFullYear(i,0,4);const y=x.getUTCDay()||7,p=(o-1)*7+m+1-y;return x.setUTCDate(x.getUTCDate()+p),x}const zs=[31,null,31,30,31,30,31,31,30,31,30,31];function jt(i){return i%400===0||i%4===0&&i%100!==0}function Bs(i,o,m){return o>=0&&o<=11&&m>=1&&m<=(zs[o]||(jt(i)?29:28))}function _s(i,o){return o>=1&&o<=(jt(i)?366:365)}function Ys(i,o,m){return o>=1&&o<=53&&m>=0&&m<=6}function Us(i,o,m){return i===24?o===0&&m===0:m>=0&&m<60&&o>=0&&o<60&&i>=0&&i<25}function Vs(i,o){return o>=0&&o<=59}function Ks({batches:i}){const[o,m]=k.useState(new Date),[x,y]=k.useState(null),[p,L]=k.useState(!1),I=Array.isArray(i)?i:[],P=[];I.forEach(f=>{var S,O;(S=f.collectionInfo)!=null&&S.collectedAt?P.push({date:f.collectionInfo.collectedAt,type:"collection",label:"ìˆ˜ê¸ˆ",amount:f.collectionInfo.amount,batchId:f.batchId,weekLabel:f.weekLabel}):["collected","paid","completed"].includes(f.status)&&P.push({date:f.endDate,type:"collection",label:"ìˆ˜ê¸ˆ (ìƒíƒœê¸°ì¤€)",amount:f.totalCommission,batchId:f.batchId,weekLabel:f.weekLabel}),(f.payoutItems||[]).forEach($=>{$.paidAt&&P.push({date:$.paidAt,type:"payout",label:`ì§€ê¸‰: ${$.partnerName||"ë¯¸ì§€ì •"}`,amount:$.amount,batchId:f.batchId,weekLabel:f.weekLabel})}),(O=f.purchaseInvoice)!=null&&O.receivedAt&&P.push({date:f.purchaseInvoice.receivedAt,type:"invoice",label:"ì„¸ê¸ˆê³„ì‚°ì„œ ìˆ˜ì·¨",batchId:f.batchId,weekLabel:f.weekLabel})});const N=f=>{const S=je(f,"yyyy-MM-dd");return P.filter(O=>(O.date?O.date.substring(0,10):"")===S)},G=()=>e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("button",{onClick:()=>m(is(o,1)),className:"p-2 hover:bg-gray-100 rounded-full",children:e.jsx(yt,{size:20})}),e.jsx("h3",{className:"text-lg font-bold text-gray-700",children:je(o,"yyyyë…„ Mì›”",{locale:at})}),e.jsx("button",{onClick:()=>m(cs(o,1)),className:"p-2 hover:bg-gray-100 rounded-full",children:e.jsx(ft,{size:20})})]}),Se=()=>{const f=["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "];return e.jsx("div",{className:"grid grid-cols-7 mb-2",children:f.map(S=>e.jsx("div",{className:"text-center text-sm font-medium text-gray-500 py-2",children:S},S))})},Ce=()=>{const f=xs(o),S=ms(f),O=Zt(f),$=bs(S),E=[];let Y=[],F=O;for(;F<=$;){for(let me=0;me<7;me++){const se=F,X=N(F),ae=X.length>0,J=ys(F,f),re=x&&ds(F,x);Y.push(e.jsxs("div",{onClick:()=>{ae&&(y(se),L(!0))},className:`
              min-h-[60px] p-1 border border-gray-100 cursor-pointer transition-all
              ${J?"hover:bg-blue-50":"bg-gray-50 text-gray-300"}
              ${rt(F)?"bg-blue-50 border-blue-300":""}
              ${re?"ring-2 ring-blue-500":""}
            `,children:[e.jsx("span",{className:`text-sm ${rt(F)?"font-bold text-blue-600":""}`,children:je(F,"d")}),ae&&e.jsxs("div",{className:"mt-1 space-y-0.5",children:[X.slice(0,2).map((z,pe)=>e.jsxs("div",{className:`text-[10px] px-1 py-0.5 rounded truncate
                      ${z.type==="collection"?"bg-green-100 text-green-700":z.type==="payout"?"bg-orange-100 text-orange-700":"bg-purple-100 text-purple-700"}`,children:[z.type==="collection"?"ðŸ’°":z.type==="payout"?"ðŸ’³":"ðŸ“¥"," ",z.amount?`${z.amount}ë§Œì›`:z.label]},pe)),X.length>2&&e.jsxs("div",{className:"text-[10px] text-gray-500",children:["+",X.length-2,"ê±´ ë”"]})]})]},F.toString())),F=Gt(F,1)}E.push(e.jsx("div",{className:"grid grid-cols-7",children:Y},F.toString())),Y=[]}return e.jsx("div",{children:E})},T=()=>{if(!p||!x)return null;const f=N(x);return e.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",onClick:()=>L(!1),children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md p-6",onClick:S=>S.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800",children:["ðŸ“… ",je(x,"yyyyë…„ Mì›” dì¼ (EEEE)",{locale:at})]}),e.jsx("button",{onClick:()=>L(!1),className:"p-1 hover:bg-gray-100 rounded-full",children:e.jsx(Xt,{size:20})})]}),e.jsx("div",{className:"space-y-3 max-h-[400px] overflow-y-auto",children:f.map((S,O)=>e.jsx("div",{className:`p-4 rounded-lg border
                  ${S.type==="collection"?"bg-green-50 border-green-200":S.type==="payout"?"bg-orange-50 border-orange-200":"bg-purple-50 border-purple-200"}`,children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("span",{className:`text-sm font-bold
                      ${S.type==="collection"?"text-green-700":S.type==="payout"?"text-orange-700":"text-purple-700"}`,children:S.type==="collection"?"ðŸ’° ìˆ˜ê¸ˆ":S.type==="payout"?"ðŸ’³ ì§€ê¸‰":"ðŸ“¥ ì„¸ê¸ˆê³„ì‚°ì„œ"}),e.jsx("p",{className:"text-gray-600 text-sm mt-1",children:S.label}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:S.weekLabel})]}),S.amount&&e.jsxs("span",{className:"text-lg font-bold text-gray-800",children:[S.amount.toLocaleString(),"ë§Œì›"]})]})},O))})]})})};return e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-700",children:"ðŸ“† ì •ì‚° ížˆìŠ¤í† ë¦¬ ìº˜ë¦°ë”"}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["ì´ ",P.length,"ê°œì˜ ì´ë²¤íŠ¸ / ",I.length,"ê°œ ë°°ì¹˜"]})]}),e.jsxs("div",{className:"flex gap-2 text-xs",children:[e.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-700 rounded-full",children:"ðŸ’° ìˆ˜ê¸ˆ"}),e.jsx("span",{className:"px-2 py-1 bg-orange-100 text-orange-700 rounded-full",children:"ðŸ’³ ì§€ê¸‰"}),e.jsx("span",{className:"px-2 py-1 bg-purple-100 text-purple-700 rounded-full",children:"ðŸ“¥ ì„¸ê¸ˆê³„ì‚°ì„œ"})]})]}),G(),Se(),Ce(),T()]})}const Zs=(i,o,m="Sheet1")=>{const x=Re.book_new(),y=Re.json_to_sheet(o),p=o.length>0?Object.keys(o[0]).map(L=>({wch:Math.max(L.length,...o.map(I=>I[L]?I[L].toString().length:0))+2})):[];y["!cols"]=p,Re.book_append_sheet(x,y,m),fs(x,`${i}.xlsx`)};function ha(){const{showToast:i}=qt(),[o,m]=k.useState([]),[x,y]=k.useState([]),[p,L]=k.useState(""),[I,P]=k.useState(new Date().getFullYear()),[N,G]=k.useState("all"),[Se,Ce]=k.useState(!0),[T,f]=k.useState("monday"),[S,O]=k.useState(()=>Ne(new Date)),[$,E]=k.useState([]),[Y,F]=k.useState(!1),[me,se]=k.useState(!1),[X,ae]=k.useState(!1),[J,re]=k.useState([]),[z,pe]=k.useState(!1),[Nt,ne]=k.useState(!1),[he,le]=k.useState(null),[M,U]=k.useState({category:"ê´‘ê³ ë¹„",amount:0,description:"",date:new Date().toISOString().split("T")[0]}),[B,De]=k.useState({total:0,byCategory:{ê´‘ê³ ë¹„:0,ë§ˆì¼€íŒ…ë¹„:0,ì‚¬ë¬´ë¹„ìš©:0,ì¸ê±´ë¹„:0,êµí†µë¹„:0,ì‹ëŒ€:0,ê¸°íƒ€:0},byMonth:[]});if(k.useEffect(()=>{(async()=>{const[a,r]=await Promise.all([tt(),ts()]);m(a),y(r),r.length>0&&L(r[0].partnerId),Ce(!1),setTimeout(async()=>{const s=await tt(),l=Array.isArray(s)?s:[],c=Array.isArray(a)?a:[];l.length>c.length&&(console.log("[Settlement] Re-fetched cases:",l.length),m(l))},1500)})()},[]),k.useEffect(()=>{(async()=>{if(!p||p==="all")return;F(!0);const a=await ss(p,S.getFullYear());E(Array.isArray(a)?a:[]),F(!1)})()},[p,S]),k.useEffect(()=>{(async()=>{if(T!=="expenses")return;pe(!0);const[a,r]=await Promise.all([Ee(p,I),Me(I,N,p)]);re(a),De(r),pe(!1)})()},[T,I,N,p]),Se)return e.jsx("div",{children:"ë¡œë”©ì¤‘..."});const V=Array.isArray(o)?o:[],_=p==="all",b=_?null:x.find(t=>t.partnerId===p),ke=Jt(S),n=(Array.isArray($)?$:[]).find(t=>t.weekLabel===ke&&t.partnerId===p),vt=()=>{const t=new Date(S);t.setDate(t.getDate()-7),O(Ne(t))},wt=()=>{const t=new Date(S);t.setDate(t.getDate()+7),O(Ne(t))},It=()=>O(Ne(new Date)),St=async()=>{if(!p||p==="all")return;F(!0);const t=await ns(p,S);E(a=>a.find(s=>s.batchId===t.batchId)?a:[t,...a]),F(!1),i(`${ke} ë°°ì¹˜ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.`,"success")},Ct=async()=>{if(!n)return;F(!0);const t=await ls(n.batchId);t&&(E(a=>a.map(r=>r.batchId===t.batchId?t:r)),i("ë°°ì¹˜ ë°ì´í„°ê°€ ìµœì‹  ê³ ê° ì •ë³´ë¡œ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.","success")),F(!1)},_e=async t=>{n&&(await Z(n.batchId,{status:t}),E(a=>a.map(r=>r.batchId===n.batchId?{...r,status:t,updatedAt:new Date().toISOString()}:r)),i(`ìƒíƒœê°€ '${ve(t)}'(ìœ¼)ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.`,"success"))},Dt=async t=>{n&&(await Z(n.batchId,{confirmationEvidence:{text:t,confirmedAt:new Date().toISOString()},status:"confirmed"}),E(a=>a.map(r=>r.batchId===n.batchId?{...r,status:"confirmed",confirmationEvidence:{text:t,confirmedAt:new Date().toISOString()},updatedAt:new Date().toISOString()}:r)),i("í™•ì¸ ì¦ë¹™ì´ ì €ìž¥ë˜ì—ˆìŠµë‹ˆë‹¤.","success"))},kt=async t=>{if(!n)return;const a=t.supplyAmount+t.vat;await Z(n.batchId,{invoiceInfo:{...t,total:a},status:"invoiced"}),E(r=>r.map(s=>s.batchId===n.batchId?{...s,status:"invoiced",invoiceInfo:{...t,total:a},updatedAt:new Date().toISOString()}:s)),i("ì„¸ê¸ˆê³„ì‚°ì„œ ì •ë³´ê°€ ì €ìž¥ë˜ì—ˆìŠµë‹ˆë‹¤.","success")},At=()=>{var r,s,l,c;if(!b||!n)return;const a=(((r=b.kakaoTemplates)==null?void 0:r.invoiceNotice)||"").replace(/\{\{ê±°ëž˜ì²˜ëª…\}\}/g,b.name).replace(/\{\{ì£¼ì°¨ë¼ë²¨\}\}/g,n.weekLabel).replace(/\{\{ê³µê¸‰ê°€\}\}/g,(((s=n.invoiceInfo)==null?void 0:s.supplyAmount)||0).toLocaleString()).replace(/\{\{VAT\}\}/g,(((l=n.invoiceInfo)==null?void 0:l.vat)||0).toLocaleString()).replace(/\{\{í•©ê³„\}\}/g,(((c=n.invoiceInfo)==null?void 0:c.total)||0).toLocaleString()).replace(/\{\{ê³„ì¢Œì •ë³´\}\}/g,b.bankInfo?`${b.bankInfo.bankName} ${b.bankInfo.accountNumber} (${b.bankInfo.accountHolder})`:"");navigator.clipboard.writeText(a),ae(!0),setTimeout(()=>ae(!1),2e3),i("í…œí”Œë¦¿ì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.","success")},Q=x.find(t=>t.partnerId===p),Ye=_?V:V.filter(t=>!t||!t.partnerId?!1:!!(t.partnerId===p||Q&&t.partnerId===Q.name||Q&&p&&t.partnerId&&(String(t.partnerId).includes(String(p))||String(p).includes(String(t.partnerId))))),q=Array.isArray(Ye)?Ye:[];console.log("[Settlement Debug]",{selectedPartnerId:p,selectedPartnerName:Q==null?void 0:Q.name,totalCases:V.length,partnerCasesCount:q.length,sampleCasePartnerIds:V.slice(0,5).map(t=>({name:t.customerName,partnerId:t.partnerId,contractAt:t.contractAt}))});const ue=t=>{const a=x.find(r=>r.partnerId===t.partnerId);return a?nt(t.contractFee||0,a.commissionRules):0},Lt=(t,a,r)=>{var fe,ce;const s=x.find(D=>D.partnerId===t.partnerId);if(!s)return{payable:0,thisWeekPayable:0,total:0,isPartial:!1,thisWeekDeposit:0,cumulativeDeposit:0,isThisWeekDeposit:!1,isFutureDeposit:!1,previouslyPaid:0};const l=s.commissionRules.find(D=>D.active&&(t.contractFee||0)>=D.minFee&&((t.contractFee||0)<=D.maxFee||D.maxFee===0)),c=(l==null?void 0:l.commission)||0,g=(l==null?void 0:l.fullPayoutThreshold)||0,w=t.depositHistory&&t.depositHistory.length>0?t.depositHistory:[{date:t.deposit1Date||"",amount:t.deposit1Amount||0},{date:t.deposit2Date||"",amount:t.deposit2Amount||0}],C=new Date().toISOString().split("T")[0],d=w.filter(D=>D.date&&D.date>=a&&D.date<=r),j=d.reduce((D,W)=>D+(W.amount||0),0),h=d.length>0&&d.every(D=>D.date>C),v=w.filter(D=>D.date&&D.date<=r).reduce((D,W)=>D+(W.amount||0),0),A=w.filter(D=>D.date&&D.date<a).reduce((D,W)=>D+(W.amount||0),0),u=(fe=s.settlementConfig)!=null&&fe.downPaymentPercentage?s.settlementConfig.downPaymentPercentage/100:.1,H=(ce=s.settlementConfig)!=null&&ce.firstPayoutPercentage?s.settlementConfig.firstPayoutPercentage/100:.5,ee=t.contractFee||0;let de=0;g>0&&A>=g?de=c:A>=ee*u&&(de=c*H);let te=0,ie=!1;g>0&&v>=g?(te=c,ie=!1):v>=ee*u&&(te=c*H,ie=!0);const $e=Math.max(0,te-de);return{payable:te,thisWeekPayable:$e,previouslyPaid:de,total:c,isPartial:ie,thisWeekDeposit:j,cumulativeDeposit:v,isThisWeekDeposit:j>0,isFutureDeposit:h}},R=q.filter(t=>{if(!t.contractAt||!t.contractFee)return!1;const a=t.contractAt;let r;try{r=we(a),isNaN(r.getTime())&&(r=new Date(a))}catch{return!1}if(isNaN(r.getTime()))return!1;const s=r.getFullYear(),l=r.getMonth()+1;return s===I&&(N==="all"||l===N)}),Ae=new Date().toISOString().split("T")[0],ge=t=>{const a=t.depositHistory&&t.depositHistory.length>0?t.depositHistory:[{date:t.deposit1Date||"",amount:t.deposit1Amount||0},{date:t.deposit2Date||"",amount:t.deposit2Amount||0}],r=a.filter(c=>c.date&&c.date<=Ae).reduce((c,g)=>c+(g.amount||0),0),s=a.filter(c=>c.date&&c.date>Ae).reduce((c,g)=>c+(g.amount||0),0),l=a.reduce((c,g)=>c+(g.amount||0),0);return{actualDeposit:r,expectedDeposit:s,totalDeposit:l}},Tt=()=>{const t=N==="all"?`${I}-`:`${I}-${String(N).padStart(2,"0")}`;let a=0,r=0;return q.forEach(s=>{(s.depositHistory&&s.depositHistory.length>0?s.depositHistory:[{date:s.deposit1Date||"",amount:s.deposit1Amount||0},{date:s.deposit2Date||"",amount:s.deposit2Amount||0}]).forEach(c=>{c.date&&c.date.startsWith(t)&&c.date>Ae&&c.amount>0&&(a++,r+=c.amount)})}),{expectedCount:a,expectedAmount:r}},oe=t=>{var j,h;const a=x.find(v=>v.partnerId===t.partnerId);if(!a)return{paidCommission:0,unpaidCommission:0,totalCommission:0};const r=a.commissionRules.find(v=>v.active&&(t.contractFee||0)>=v.minFee&&((t.contractFee||0)<=v.maxFee||v.maxFee===0)),s=(r==null?void 0:r.commission)||0,l=(r==null?void 0:r.fullPayoutThreshold)||0,{actualDeposit:c}=ge(t),g=(j=a.settlementConfig)!=null&&j.downPaymentPercentage?a.settlementConfig.downPaymentPercentage/100:.1,w=(h=a.settlementConfig)!=null&&h.firstPayoutPercentage?a.settlementConfig.firstPayoutPercentage/100:.5,C=t.contractFee||0;let d=0;return l>0&&c>=l?d=s:c>=C*g&&(d=s*w),{paidCommission:d,unpaidCommission:s-d,totalCommission:s}},be=R.length,Le=R.reduce((t,a)=>t+(a.contractFee||0),0),Te=R.reduce((t,a)=>t+ue(a),0),Ue=q.filter(t=>["ê³„ì•½ ì™„ë£Œ","1ì°¨ ìž…ê¸ˆì™„ë£Œ","2ì°¨ ìž…ê¸ˆì™„ë£Œ"].includes(t.status)&&!t.contractAt).length,Fe=R.reduce((t,a)=>t+ge(a).actualDeposit,0),{expectedCount:Ft,expectedAmount:Pt}=Tt(),ye=R.reduce((t,a)=>t+oe(a).paidCommission,0),Ve=Te-ye,$t=R.filter(t=>(t.installmentMonths||1)>1&&oe(t).paidCommission<oe(t).totalCommission).length,Et=R.filter(t=>{const{actualDeposit:a,totalDeposit:r}=ge(t);return r>0&&a>=r}).length,Ke=be>0?Math.round(Et/be*100):0,Ze=Array.from({length:12},(t,a)=>{const r=`${I}-${String(a+1).padStart(2,"0")}`,s=q.filter(d=>d.contractAt&&d.contractAt.startsWith(r)),l=s.reduce((d,j)=>d+(j.contractFee||0),0),c=s.reduce((d,j)=>d+ue(j),0),g=s.reduce((d,j)=>d+ge(j).actualDeposit,0),w=s.reduce((d,j)=>d+oe(j).paidCommission,0),C=c-w;return{name:`${a+1}ì›”`,count:s.length,revenue:l,commission:c,actualDeposit:g,paidCommission:w,unpaidCommission:C,netProfit:g-w}}),Mt=t=>{var a;return((a=x.find(r=>r.partnerId===t))==null?void 0:a.name)||"-"},Ge=(n==null?void 0:n.dealIds.map(t=>V.find(a=>a.caseId===t)).filter(Boolean))||[],Ot=()=>{var t,a;return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-blue-50 p-6 rounded-xl border border-blue-100",children:[e.jsxs("h3",{className:"font-bold text-blue-800 mb-4 text-lg flex items-center",children:[e.jsx(Ns,{className:"mr-2",size:20})," ì›”ìš”ì¼: ì •ì‚° í™•ì¸"]}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"í•´ë‹¹ ì£¼ì°¨ì— ì •ì‚° ëŒ€ìƒ ë”œì„ í™•ì¸í•˜ê³ , ê±°ëž˜ì²˜ ì¹´í†¡ í™•ì¸ ì¦ë¹™ì„ ê¸°ë¡í•©ë‹ˆë‹¤."}),n?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"ë”œ ìˆ˜"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-800",children:[n.dealIds.length,"ê±´"]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"ì´ ìˆ˜ìž„ë£Œ"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:[n.totalContractFee.toLocaleString(),"ë§Œì›"]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"ì´ ìˆ˜ìˆ˜ë£Œ"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600",children:[n.totalCommission.toLocaleString(),"ë§Œì›"]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"ìƒíƒœ"}),e.jsx("p",{className:`text-xl font-bold ${n.status==="draft"?"text-gray-600":"text-green-600"}`,children:ve(n.status)})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"p-3 border-b border-gray-100 bg-gray-50 flex justify-between items-center",children:[e.jsx("h4",{className:"font-bold text-gray-700 text-sm",children:"ì •ì‚° ëŒ€ìƒ ë”œ ëª©ë¡"}),e.jsxs("button",{onClick:Ct,disabled:Y,className:"flex items-center gap-1 text-sm text-blue-600 hover:text-blue-700 disabled:opacity-50",title:"ê³ ê° ìƒì„¸íŽ˜ì´ì§€ ë³€ê²½ì‚¬í•­ì„ ë°˜ì˜í•©ë‹ˆë‹¤",children:[e.jsx(Ts,{size:14,className:Y?"animate-spin":""}),"ìƒˆë¡œê³ ì¹¨"]})]}),e.jsx("div",{className:"max-h-48 overflow-y-auto",children:Ge.length===0?e.jsx("p",{className:"text-center text-gray-500 py-6",children:"ì •ì‚° ëŒ€ìƒ ë”œì´ ì—†ìŠµë‹ˆë‹¤."}):e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-600 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-3 py-2",children:"ê³ ê°ëª…"}),e.jsx("th",{className:"text-center px-2 py-2 text-xs",children:"ë¶„ë‚©"}),e.jsx("th",{className:"text-right px-2 py-2",children:"ìˆ˜ìž„ë£Œ"}),e.jsx("th",{className:"text-right px-2 py-2",children:"ìž…ê¸ˆì•¡"}),e.jsx("th",{className:"text-right px-2 py-2 text-orange-600",children:"ì´ìˆ˜ìˆ˜ë£Œ"}),e.jsx("th",{className:"text-right px-2 py-2 text-green-600 font-bold",children:"ê¸ˆì£¼ì§€ê¸‰"}),e.jsx("th",{className:"text-center px-2 py-2",children:"ìƒíƒœ"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:Ge.map(r=>{var l;const s=Lt(r,n.startDate,n.endDate);return e.jsxs("tr",{className:`hover:bg-gray-50 ${s.isFutureDeposit?"bg-purple-50/50":""}`,children:[e.jsxs("td",{className:"px-3 py-2 font-medium",children:[r.customerName,s.isFutureDeposit&&e.jsx("span",{className:"ml-1 text-xs text-purple-500",children:"(ì˜ˆìƒ)"})]}),e.jsx("td",{className:"px-2 py-2 text-center text-xs text-gray-500",children:r.installmentMonths||"-"}),e.jsxs("td",{className:"px-2 py-2 text-right text-gray-700",children:[(l=r.contractFee)==null?void 0:l.toLocaleString(),"ë§Œì›"]}),e.jsxs("td",{className:`px-2 py-2 text-right font-medium ${s.isFutureDeposit?"text-purple-500":"text-blue-600"}`,children:[s.isFutureDeposit&&e.jsx("span",{className:"text-xs mr-0.5",children:"ì˜ˆìƒ"}),s.thisWeekDeposit.toLocaleString(),"ë§Œì›"]}),e.jsxs("td",{className:"px-2 py-2 text-right text-orange-500",children:[s.total.toLocaleString(),"ë§Œì›"]}),e.jsxs("td",{className:`px-2 py-2 text-right font-bold ${s.isFutureDeposit?"text-purple-600":"text-green-600"}`,children:[s.isFutureDeposit&&e.jsx("span",{className:"text-xs mr-0.5",children:"ì˜ˆìƒ"}),s.thisWeekPayable.toLocaleString(),"ë§Œì›"]}),e.jsx("td",{className:"px-2 py-2 text-center",children:s.isFutureDeposit?e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs bg-purple-100 text-purple-700",children:"ì˜ˆìƒ"}):s.isPartial?e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs bg-yellow-100 text-yellow-700",children:"50%"}):s.thisWeekPayable>0?e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs bg-green-100 text-green-700",children:"100%"}):e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs bg-gray-100 text-gray-500",children:"ëŒ€ê¸°"})})]},r.caseId)})})]})})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[e.jsx("h4",{className:"font-bold text-gray-700 mb-2 text-sm",children:"ðŸ“ ì¹´í†¡ í™•ì¸ ì¦ë¹™"}),e.jsx("textarea",{className:"w-full p-3 border border-gray-300 rounded-lg text-sm",rows:3,placeholder:"ê±°ëž˜ì²˜ì™€ì˜ ì¹´í†¡ í™•ì¸ ë‚´ìš©ì„ ê¸°ë¡í•˜ì„¸ìš”...",defaultValue:((t=n.confirmationEvidence)==null?void 0:t.text)||"",onBlur:r=>{var s;r.target.value!==((s=n.confirmationEvidence)==null?void 0:s.text)&&Dt(r.target.value)}}),((a=n.confirmationEvidence)==null?void 0:a.confirmedAt)&&e.jsxs("p",{className:"text-xs text-green-600 mt-2",children:["âœ“ ",new Date(n.confirmationEvidence.confirmedAt).toLocaleString()," í™•ì¸ë¨"]})]}),n.status==="draft"&&e.jsx("button",{onClick:()=>_e("confirmed"),className:"w-full bg-blue-600 text-white py-3 rounded-lg font-bold hover:bg-blue-700",children:"âœ“ ì •ì‚° í™•ì¸ ì™„ë£Œ (ë½0)"})]}):e.jsxs("div",{className:"bg-white p-6 rounded-lg border border-gray-200 text-center",children:[e.jsx("p",{className:"text-gray-500 mb-4",children:"ì´ ì£¼ì°¨ì— ëŒ€í•œ ë°°ì¹˜ê°€ ì—†ìŠµë‹ˆë‹¤."}),e.jsx("button",{onClick:St,disabled:Y||p==="all",className:"bg-blue-600 text-white px-6 py-2 rounded-lg font-bold hover:bg-blue-700 disabled:opacity-50",children:Y?"ìƒì„± ì¤‘...":"ë°°ì¹˜ ìƒì„±í•˜ê¸°"})]})]})})},Ht=()=>{var t,a,r,s,l,c,g,w,C,d;return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-yellow-50 p-6 rounded-xl border border-yellow-100",children:[e.jsxs("h3",{className:"font-bold text-yellow-800 mb-4 text-lg flex items-center",children:[e.jsx(vs,{className:"mr-2",size:20})," í™”ìš”ì¼: ë°œí–‰ / ìˆ˜ê¸ˆ"]}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"ì„¸ê¸ˆê³„ì‚°ì„œë¥¼ ë°œí–‰í•˜ê³ , ìˆ˜ê¸ˆ ìƒíƒœë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤."}),n?n.status==="draft"?e.jsxs("div",{className:"bg-white p-6 rounded-lg border border-gray-200 text-center",children:[e.jsx(st,{className:"mx-auto text-yellow-500 mb-2",size:32}),e.jsx("p",{className:"text-gray-600",children:"ë¨¼ì € ì›”ìš”ì¼ íƒ­ì—ì„œ ì •ì‚° í™•ì¸ì„ ì™„ë£Œí•´ì£¼ì„¸ìš”."})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[e.jsx("h4",{className:"font-bold text-gray-700 mb-3 text-sm",children:"ðŸ“„ ì„¸ê¸ˆê³„ì‚°ì„œ ì •ë³´"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-500 block mb-1",children:"ë°œí–‰ì¼"}),e.jsx("input",{type:"date",className:"w-full p-2 border border-gray-300 rounded text-sm",defaultValue:((t=n.invoiceInfo)==null?void 0:t.issueDate)||"",id:"issueDate"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-500 block mb-1",children:"ê³µê¸‰ê°€ (ë§Œì›)"}),e.jsx("input",{type:"number",className:"w-full p-2 border border-gray-300 rounded text-sm",defaultValue:((a=n.invoiceInfo)==null?void 0:a.supplyAmount)||n.totalCommission,id:"supplyAmount"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-500 block mb-1",children:"VAT (ë§Œì›)"}),e.jsx("input",{type:"number",className:"w-full p-2 border border-gray-300 rounded text-sm",defaultValue:((r=n.invoiceInfo)==null?void 0:r.vat)||Math.round(n.totalCommission*.1),id:"vat"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-500 block mb-1",children:"ìŠ¹ì¸ë²ˆí˜¸"}),e.jsx("input",{type:"text",className:"w-full p-2 border border-gray-300 rounded text-sm",placeholder:"ë°œí–‰ í›„ ìž…ë ¥",defaultValue:((s=n.invoiceInfo)==null?void 0:s.approvalNumber)||"",id:"approvalNumber"})]})]}),e.jsx("button",{onClick:()=>{const j=document.getElementById("issueDate").value,h=Number(document.getElementById("supplyAmount").value),v=Number(document.getElementById("vat").value),A=document.getElementById("approvalNumber").value;kt({issueDate:j,supplyAmount:h,vat:v,approvalNumber:A})},className:"mt-4 bg-yellow-600 text-white px-4 py-2 rounded-lg font-bold hover:bg-yellow-700",children:"ðŸ’¾ ì €ìž¥"})]}),((l=b==null?void 0:b.kakaoTemplates)==null?void 0:l.invoiceNotice)&&e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h4",{className:"font-bold text-gray-700 text-sm",children:"ðŸ“± ì¹´í†¡ í…œí”Œë¦¿"}),e.jsxs("button",{onClick:At,className:"flex items-center gap-1 text-sm text-blue-600 hover:text-blue-700",children:[X?e.jsx(Is,{size:14}):e.jsx(Ss,{size:14}),X?"ë³µì‚¬ë¨!":"ë³µì‚¬"]})]}),e.jsx("div",{className:"bg-gray-50 p-3 rounded text-sm text-gray-600 whitespace-pre-line",children:b.kakaoTemplates.invoiceNotice.replace(/\{\{ê±°ëž˜ì²˜ëª…\}\}/g,b.name).replace(/\{\{ì£¼ì°¨ë¼ë²¨\}\}/g,n.weekLabel).replace(/\{\{ê³µê¸‰ê°€\}\}/g,(((c=n.invoiceInfo)==null?void 0:c.supplyAmount)||n.totalCommission).toLocaleString()).replace(/\{\{VAT\}\}/g,(((g=n.invoiceInfo)==null?void 0:g.vat)||Math.round(n.totalCommission*.1)).toLocaleString()).replace(/\{\{í•©ê³„\}\}/g,(((w=n.invoiceInfo)==null?void 0:w.total)||Math.round(n.totalCommission*1.1)).toLocaleString()).replace(/\{\{ê³„ì¢Œì •ë³´\}\}/g,b.bankInfo?`${b.bankInfo.bankName} ${b.bankInfo.accountNumber} (${b.bankInfo.accountHolder})`:"(ê³„ì¢Œì •ë³´ ë¯¸ì„¤ì •)")})]}),n.status!=="draft"&&e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[e.jsx("h4",{className:"font-bold text-gray-700 mb-2 text-sm",children:"ðŸ’° ìˆ˜ê¸ˆ ìƒíƒœ"}),(C=n.collectionInfo)!=null&&C.collectedAt?e.jsxs("p",{className:"text-green-600 font-bold",children:["âœ“ ìˆ˜ê¸ˆì™„ë£Œ (",n.collectionInfo.collectedAt,") - ",(d=n.collectionInfo.amount)==null?void 0:d.toLocaleString(),"ë§Œì›"]}):e.jsx("button",{onClick:()=>_e("collected"),className:"bg-green-600 text-white px-4 py-2 rounded-lg font-bold hover:bg-green-700",children:"ìˆ˜ê¸ˆ ì™„ë£Œ ì²˜ë¦¬"})]})]}):e.jsx("div",{className:"bg-white p-6 rounded-lg border border-gray-200 text-center",children:e.jsx("p",{className:"text-gray-500",children:"ë¨¼ì € ì›”ìš”ì¼ íƒ­ì—ì„œ ë°°ì¹˜ë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”."})})]})})},Wt=()=>{var C,d,j;const t=(n==null?void 0:n.payoutItems)||[],a=async()=>{if(!n)return;const h={id:`payout-${Date.now()}`,partnerName:"",partnerAccount:"",amount:0},v=[...t,h];await Z(n.batchId,{payoutItems:v}),E(A=>A.map(u=>u.batchId===n.batchId?{...u,payoutItems:v}:u))},r=async(h,v)=>{if(!n)return;const A=t.map(u=>u.id===h?{...u,...v}:u);await Z(n.batchId,{payoutItems:A}),E(u=>u.map(H=>H.batchId===n.batchId?{...H,payoutItems:A}:H))},s=async h=>{if(!n)return;const v=t.filter(A=>A.id!==h);await Z(n.batchId,{payoutItems:v}),E(A=>A.map(u=>u.batchId===n.batchId?{...u,payoutItems:v}:u))},l=async h=>{const v=new Date().toISOString().split("T")[0];await r(h,{paidAt:v})},c=async()=>{if(!n)return;const v={collectedAt:new Date().toISOString().split("T")[0],amount:n.totalCommission};await Z(n.batchId,{collectionInfo:v,status:"collected"}),E(A=>A.map(u=>u.batchId===n.batchId?{...u,collectionInfo:v,status:"collected"}:u)),i("ìˆ˜ê¸ˆ ì™„ë£Œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.","success")},g=async()=>{if(!n)return;const v={receivedAt:new Date().toISOString().split("T")[0]};await Z(n.batchId,{purchaseInvoice:v,status:"completed"}),E(A=>A.map(u=>u.batchId===n.batchId?{...u,purchaseInvoice:v,status:"completed"}:u)),i("ë§¤ìž… ì„¸ê¸ˆê³„ì‚°ì„œ ìˆ˜ì·¨ ì™„ë£Œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.","success")},w=(b==null?void 0:b.payoutPartnerPresets)||[];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-blue-50 p-6 rounded-xl border border-blue-100",children:[e.jsx("h3",{className:"font-bold text-blue-800 mb-4 text-lg flex items-center",children:"ðŸ’° ìˆ˜ê¸ˆ ì •ë³´ (ê±°ëž˜ì²˜ì—ì„œ ë°›ì„ ê¸ˆì•¡)"}),!n||!["collected","invoiced","confirmed","paid","completed"].includes(n.status)?e.jsxs("div",{className:"bg-white p-6 rounded-lg border border-gray-200 text-center",children:[e.jsx(st,{className:"mx-auto text-yellow-500 mb-2",size:32}),e.jsx("p",{className:"text-gray-600",children:"í™”ìš”ì¼ íƒ­ì—ì„œ ë°œí–‰ì„ ë¨¼ì € ì™„ë£Œí•´ì£¼ì„¸ìš”."})]}):e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"ìˆ˜ê¸ˆ ëŒ€ìƒ ê¸ˆì•¡"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-700",children:[n.totalCommission.toLocaleString(),"ë§Œì›"]})]}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"ê±°ëž˜ì²˜"}),e.jsx("p",{className:"text-lg font-bold text-gray-700",children:b==null?void 0:b.name})]}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"ë‚´ ìž…ê¸ˆ ê³„ì¢Œ"}),e.jsx("p",{className:"text-sm font-medium text-gray-600",children:b!=null&&b.bankInfo?`${b.bankInfo.bankName} ${b.bankInfo.accountNumber}`:"(ì„¤ì •ì—ì„œ ìž…ë ¥)"})]})]}),(C=n.collectionInfo)!=null&&C.collectedAt?e.jsxs("div",{className:"bg-green-50 p-3 rounded-lg border border-green-200",children:[e.jsxs("p",{className:"text-green-700 font-bold text-lg",children:["âœ“ ìˆ˜ê¸ˆì™„ë£Œ (",n.collectionInfo.collectedAt,")"]}),e.jsxs("p",{className:"text-green-600",children:[(d=n.collectionInfo.amount)==null?void 0:d.toLocaleString(),"ë§Œì› ìž…ê¸ˆ í™•ì¸"]})]}):e.jsx("button",{onClick:c,className:"w-full bg-blue-600 text-white py-3 rounded-lg font-bold hover:bg-blue-700",children:"ðŸ’° ìˆ˜ê¸ˆ ì™„ë£Œ ì²˜ë¦¬"})]})]}),e.jsxs("div",{className:"bg-green-50 p-6 rounded-xl border border-green-100",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"font-bold text-green-800 text-lg flex items-center",children:[e.jsx(As,{className:"mr-2",size:20})," íŒŒíŠ¸ë„ˆ ì§€ê¸‰ (",t.length,"ê±´)"]}),n&&["collected","invoiced","confirmed","paid","completed"].includes(n.status)&&e.jsxs("button",{onClick:a,className:"bg-green-600 text-white px-3 py-1.5 rounded-lg text-sm font-medium hover:bg-green-700 flex items-center gap-1",children:[e.jsx(mt,{size:16})," ì§€ê¸‰ ì¶”ê°€"]})]}),t.length===0?e.jsx("p",{className:"text-sm text-gray-500 bg-white p-4 rounded-lg",children:'íŒŒíŠ¸ë„ˆ ì§€ê¸‰ì´ ì—†ìœ¼ë©´ "ì§€ê¸‰ ì¶”ê°€" ì—†ì´ ë‘ì„¸ìš”.'}):e.jsx("div",{className:"space-y-3",children:t.map((h,v)=>{var A;return e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-500",children:["ì§€ê¸‰ #",v+1]}),!h.paidAt&&e.jsx("button",{onClick:()=>s(h.id),className:"text-red-500 hover:text-red-700",children:e.jsx(pt,{size:16})})]}),w.length>0&&!h.partnerName&&e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"í”„ë¦¬ì…‹ ì„ íƒ"}),e.jsxs("select",{onChange:u=>{const H=w.find(ee=>ee.id===u.target.value);H&&r(h.id,{partnerName:H.name,partnerAccount:H.accountInfo,amount:H.defaultAmount||0})},className:"w-full border border-gray-300 rounded-lg px-3 py-2",children:[e.jsx("option",{value:"",children:"ì§ì ‘ ìž…ë ¥"}),w.map(u=>e.jsxs("option",{value:u.id,children:[u.name," - ",u.accountInfo]},u.id))]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"íŒŒíŠ¸ë„ˆëª…"}),e.jsx("input",{type:"text",defaultValue:h.partnerName,onBlur:u=>r(h.id,{partnerName:u.target.value}),className:"w-full border border-gray-300 rounded-lg px-3 py-2",placeholder:"íŒŒíŠ¸ë„ˆëª…"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"ê³„ì¢Œì •ë³´"}),e.jsx("input",{type:"text",defaultValue:h.partnerAccount,onBlur:u=>r(h.id,{partnerAccount:u.target.value}),className:"w-full border border-gray-300 rounded-lg px-3 py-2",placeholder:"ì€í–‰ ê³„ì¢Œë²ˆí˜¸"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"ê¸ˆì•¡ (ë§Œì›)"}),e.jsx("input",{type:"number",defaultValue:h.amount,onBlur:u=>r(h.id,{amount:parseInt(u.target.value)||0}),className:"w-full border border-gray-300 rounded-lg px-3 py-2 font-bold",placeholder:"0"})]})]}),e.jsx("div",{className:"mt-3",children:h.paidAt?e.jsx("div",{className:"bg-green-50 p-2 rounded border border-green-200",children:e.jsxs("p",{className:"text-green-700 font-bold",children:["âœ“ ì§€ê¸‰ì™„ë£Œ (",h.paidAt,") - ",(A=h.amount)==null?void 0:A.toLocaleString(),"ë§Œì›"]})}):e.jsx("button",{onClick:()=>l(h.id),className:"w-full bg-green-600 text-white py-2 rounded-lg font-medium hover:bg-green-700",children:"âœ“ ì§€ê¸‰ ì™„ë£Œ ì²˜ë¦¬"})})]},h.id)})})]}),e.jsxs("div",{className:"bg-purple-50 p-6 rounded-xl border border-purple-100",children:[e.jsx("h3",{className:"font-bold text-purple-800 mb-4 text-lg flex items-center",children:"ðŸ“¥ ë§¤ìž… ì„¸ê¸ˆê³„ì‚°ì„œ ìˆ˜ì·¨"}),n&&["collected","invoiced","confirmed","paid","completed"].includes(n.status)&&e.jsx("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:(j=n.purchaseInvoice)!=null&&j.receivedAt?e.jsx("div",{className:"bg-purple-50 p-3 rounded border border-purple-200",children:e.jsxs("p",{className:"text-purple-700 font-bold text-lg",children:["âœ“ ìˆ˜ì·¨ì™„ë£Œ (",n.purchaseInvoice.receivedAt,")"]})}):e.jsx("button",{onClick:g,className:"w-full bg-purple-600 text-white py-3 rounded-lg font-bold hover:bg-purple-700",children:"ðŸ“¥ ë§¤ìž… ì„¸ê¸ˆê³„ì‚°ì„œ ìˆ˜ì·¨ ì™„ë£Œ"})})]})]})},Rt=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{onClick:()=>se(!0),className:"bg-white p-5 rounded-xl shadow-sm border border-gray-100 cursor-pointer hover:bg-gray-50 hover:border-blue-300 transition-all group",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"ðŸ“‹ ê³„ì•½ ê±´ìˆ˜"}),e.jsx(ws,{size:14,className:"text-gray-300 group-hover:text-blue-500"})]}),e.jsxs("p",{className:"text-2xl font-bold text-gray-800 mt-1",children:[be,"ê±´"]}),e.jsx("p",{className:"text-xs text-blue-500 mt-1",children:"ìƒì„¸ ë³´ê¸° â†’"})]}),e.jsxs("div",{className:"bg-white p-5 rounded-xl shadow-sm border border-gray-100",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"ðŸ’° ì´ ë§¤ì¶œ"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600 mt-1",children:[Le.toLocaleString(),"ë§Œì›"]}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"ìˆ˜ìž„ë£Œ í•©ê³„"})]}),e.jsxs("div",{className:"bg-white p-5 rounded-xl shadow-sm border border-gray-100",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"âœ… ì‹¤ì œ ìž…ê¸ˆì•¡"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600 mt-1",children:[Fe.toLocaleString(),"ë§Œì›"]}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"ì˜¤ëŠ˜ê¹Œì§€ í™•ì •"})]}),e.jsxs("div",{className:"bg-white p-5 rounded-xl shadow-sm border border-gray-100",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"ðŸ“… ì˜ˆìƒ ìž…ê¸ˆì•¡"}),e.jsxs("p",{className:"text-2xl font-bold text-orange-500 mt-1",children:[Pt.toLocaleString(),"ë§Œì›"]}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:[Ft,"ê±´ ìž…ê¸ˆ ì˜ˆì •"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-white p-5 rounded-xl shadow-sm border border-green-200",children:[e.jsx("p",{className:"text-sm text-green-700",children:"ðŸ’µ ì§€ê¸‰ëœ ìˆ˜ìˆ˜ë£Œ"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600 mt-1",children:[ye.toLocaleString(),"ë§Œì›"]}),e.jsx("p",{className:"text-xs text-green-500 mt-1",children:"ìž…ê¸ˆ í™•ì • ê¸°ì¤€"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-orange-50 to-white p-5 rounded-xl shadow-sm border border-orange-200",children:[e.jsx("p",{className:"text-sm text-orange-700",children:"ðŸ”œ ë¯¸ì§€ê¸‰ ìˆ˜ìˆ˜ë£Œ"}),e.jsxs("p",{className:"text-2xl font-bold text-orange-600 mt-1",children:[Ve.toLocaleString(),"ë§Œì›"]}),e.jsx("p",{className:"text-xs text-orange-500 mt-1",children:"ì¶”ê°€ ìž…ê¸ˆ í•„ìš”"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-indigo-50 to-white p-5 rounded-xl shadow-sm border border-indigo-200",children:[e.jsx("p",{className:"text-sm text-indigo-700",children:"ðŸ“Š ë¶„ë‚© ì§„í–‰ì¤‘"}),e.jsxs("p",{className:"text-2xl font-bold text-indigo-600 mt-1",children:[$t,"ê±´"]}),e.jsx("p",{className:"text-xs text-indigo-500 mt-1",children:"ì¶”ê°€ ìž…ê¸ˆ ëŒ€ê¸°"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-white p-5 rounded-xl shadow-sm border border-blue-200",children:[e.jsx("p",{className:"text-sm text-blue-700",children:"ðŸ“ˆ ìž…ê¸ˆ ì™„ë£Œìœ¨"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600 mt-1",children:[Ke,"%"]}),e.jsx("div",{className:"mt-2 h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-blue-500 rounded-full",style:{width:`${Ke}%`}})})]})]}),(()=>{const t=Array.isArray(q)?q:[],a=new Date,r=t.filter(s=>{if(s.status==="ì¢…ê²°"||s.status==="ì·¨ì†Œ")return!1;const l=s.contractFee||0,c=(s.depositHistory||[]).reduce((j,h)=>j+(h.amount||0),0);if(l-c<=0)return!1;let w=s.contractAt||s.createdAt;if(s.depositHistory&&s.depositHistory.length>0){const j=s.depositHistory.map(h=>h.date).sort();w=j[j.length-1]}if(!w)return!1;const C=we(w);return ze(a,C)>=30}).map(s=>{const l=s.contractFee||0,c=(s.depositHistory||[]).reduce((C,d)=>C+(d.amount||0),0),g=l-c;let w=s.contractAt||s.createdAt;if(s.depositHistory&&s.depositHistory.length>0){const C=s.depositHistory.map(d=>d.date).sort();w=C[C.length-1]}return{...s,unpaidAmount:g,overdueDays:ze(a,we(w))}}).sort((s,l)=>l.unpaidAmount-s.unpaidAmount);return r.length===0?null:e.jsxs("div",{className:"bg-red-50 rounded-xl shadow-sm border border-red-100 p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"p-1.5 bg-red-100 text-red-600 rounded-lg",children:"ðŸš¨"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-red-800",children:"ìž¥ê¸° ë¯¸ìˆ˜ê¸ˆ í˜„í™©"}),e.jsxs("p",{className:"text-xs text-red-600",children:["ìµœê·¼ 30ì¼ ì´ìƒ ë¯¸ìž…ê¸ˆ ê³ ê° (",r.length,"ëª…)"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-red-500",children:"ì´ ë¯¸ìˆ˜ê¸ˆ"}),e.jsxs("p",{className:"font-bold text-red-700 text-lg",children:[r.reduce((s,l)=>s+l.unpaidAmount,0).toLocaleString(),"ë§Œì›"]})]})]}),e.jsx("div",{className:"flex gap-4 overflow-x-auto pb-2 scrollbar-hide",children:r.map(s=>{var l;return e.jsxs("div",{className:"min-w-[240px] bg-white p-4 rounded-lg border border-red-200 shadow-sm flex-shrink-0",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("span",{className:"font-bold text-gray-800",children:s.customerName}),e.jsxs("span",{className:"px-2 py-0.5 bg-red-100 text-red-600 text-xs rounded-full font-bold",children:["+",s.overdueDays,"ì¼ì§¸"]})]}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"ë¯¸ë‚©ì•¡"}),e.jsxs("span",{className:"font-bold text-red-600",children:[s.unpaidAmount.toLocaleString(),"ë§Œì›"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"ì§„í–‰ìƒíƒœ"}),e.jsx("span",{className:"text-gray-700",children:s.status})]})]}),e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-100 flex justify-between items-center",children:e.jsxs("p",{className:"text-xs text-gray-400",children:["ë§ˆì§€ë§‰: ",(l=s.depositHistory)!=null&&l.length?"ìž…ê¸ˆ":"ê³„ì•½","ì¼ ê¸°ì¤€"]})})]},s.caseId)})})]})})(),e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-100 h-80 flex flex-col",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-700 mb-4 flex-shrink-0",children:"ðŸ“Š ì›”ë³„ ìˆ˜ìµ í˜„í™©"}),e.jsx("div",{className:"flex-1 min-h-0 w-full",children:e.jsx(Oe,{width:"100%",height:"100%",children:e.jsxs(dt,{data:Ze,children:[e.jsx(it,{strokeDasharray:"3 3",vertical:!1}),e.jsx(ct,{dataKey:"name"}),e.jsx(xt,{}),e.jsx(He,{formatter:t=>[`${t.toLocaleString()}ë§Œì›`,""]}),e.jsx(ps,{}),e.jsx(We,{dataKey:"actualDeposit",fill:"#10b981",name:"ì‹¤ì œìž…ê¸ˆ",radius:[4,4,0,0]}),e.jsx(We,{dataKey:"paidCommission",fill:"#ef4444",name:"ì§€ê¸‰ìˆ˜ìˆ˜ë£Œ",radius:[4,4,0,0]}),e.jsx(Cs,{type:"monotone",dataKey:"netProfit",stroke:"#3b82f6",strokeWidth:2,name:"ìˆœìˆ˜ìµ (ìž…ê¸ˆ-ì§€ê¸‰)",dot:{r:4}})]})})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-gray-100 bg-gray-50",children:e.jsx("h3",{className:"font-bold text-gray-700",children:"ðŸ“… ì›”ë³„ ìƒì„¸ ìš”ì•½"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-600 font-medium",children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-3 px-3 text-center",children:"ì›”"}),e.jsx("th",{className:"py-3 px-3 text-center",children:"ê±´ìˆ˜"}),e.jsx("th",{className:"py-3 px-3 text-right",children:"ë§¤ì¶œ"}),e.jsx("th",{className:"py-3 px-3 text-right text-green-600",children:"ìž…ê¸ˆì•¡"}),e.jsx("th",{className:"py-3 px-3 text-right text-blue-600",children:"ì´ìˆ˜ìˆ˜ë£Œ"}),e.jsx("th",{className:"py-3 px-3 text-right text-green-600",children:"ì§€ê¸‰ì™„ë£Œ"}),e.jsx("th",{className:"py-3 px-3 text-right text-orange-600",children:"ë¯¸ì§€ê¸‰"})]})}),e.jsxs("tbody",{children:[Ze.map((t,a)=>e.jsxs("tr",{className:`border-b border-gray-50 last:border-0 hover:bg-gray-50 ${N===a+1?"bg-blue-50":""}`,children:[e.jsx("td",{className:"py-3 px-3 font-medium text-center",children:t.name}),e.jsx("td",{className:"py-3 px-3 text-center text-gray-500",children:t.count}),e.jsxs("td",{className:"py-3 px-3 text-right text-gray-700",children:[t.revenue.toLocaleString(),"ë§Œì›"]}),e.jsxs("td",{className:"py-3 px-3 text-right text-green-600 font-medium",children:[t.actualDeposit.toLocaleString(),"ë§Œì›"]}),e.jsxs("td",{className:"py-3 px-3 text-right text-blue-600",children:[t.commission.toLocaleString(),"ë§Œì›"]}),e.jsxs("td",{className:"py-3 px-3 text-right text-green-600 font-bold",children:[t.paidCommission.toLocaleString(),"ë§Œì›"]}),e.jsxs("td",{className:"py-3 px-3 text-right text-orange-600",children:[t.unpaidCommission.toLocaleString(),"ë§Œì›"]})]},a)),e.jsxs("tr",{className:"bg-gray-100 font-bold border-t-2 border-gray-300",children:[e.jsx("td",{className:"py-3 px-3 text-center",children:"í•©ê³„"}),e.jsx("td",{className:"py-3 px-3 text-center",children:be}),e.jsxs("td",{className:"py-3 px-3 text-right text-gray-700",children:[Le.toLocaleString(),"ë§Œì›"]}),e.jsxs("td",{className:"py-3 px-3 text-right text-green-600",children:[Fe.toLocaleString(),"ë§Œì›"]}),e.jsxs("td",{className:"py-3 px-3 text-right text-blue-600",children:[Te.toLocaleString(),"ë§Œì›"]}),e.jsxs("td",{className:"py-3 px-3 text-right text-green-600",children:[ye.toLocaleString(),"ë§Œì›"]}),e.jsxs("td",{className:"py-3 px-3 text-right text-orange-600",children:[Ve.toLocaleString(),"ë§Œì›"]})]})]})]})})]}),_&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden mb-6",children:[e.jsxs("div",{className:"p-4 border-b border-gray-100 bg-gradient-to-r from-blue-50 to-white",children:[e.jsx("h3",{className:"font-bold text-gray-700",children:"ðŸ¤ íŒŒíŠ¸ë„ˆë³„ ì„±ê³¼ ë¶„ì„"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"íŒŒíŠ¸ë„ˆë³„ ìˆ˜ìž„ ê±´ìˆ˜ ë° ìˆ˜ìˆ˜ë£Œ ì§€ê¸‰ í˜„í™©"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-600 font-medium",children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-3 px-3 text-left",children:"íŒŒíŠ¸ë„ˆëª…"}),e.jsx("th",{className:"py-3 px-3 text-center",children:"ê±´ìˆ˜"}),e.jsx("th",{className:"py-3 px-3 text-right",children:"ì´ ìˆ˜ìž„ë£Œ"}),e.jsx("th",{className:"py-3 px-3 text-right text-blue-600",children:"ì§€ê¸‰ ì™„ë£Œ"}),e.jsx("th",{className:"py-3 px-3 text-right text-orange-600",children:"ë¯¸ì§€ê¸‰"}),e.jsx("th",{className:"py-3 px-3 text-right",children:"ì§€ê¸‰ë¥ "})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:x.map(t=>{const a=V.filter(C=>C.partnerId===t.partnerId);if(a.length===0)return null;const r=a.length,s=a.reduce((C,d)=>C+(d.contractFee||0),0),l=a.reduce((C,d)=>C+oe(d).paidCommission,0),c=a.reduce((C,d)=>C+ue(d),0),g=c-l,w=c>0?Math.round(l/c*100):0;return{p:t,count:r,revenue:s,paid:l,unpaid:g,rate:w}}).filter(t=>t!==null).sort((t,a)=>((a==null?void 0:a.revenue)||0)-((t==null?void 0:t.revenue)||0)).map((t,a)=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsxs("td",{className:"py-3 px-3 font-medium text-gray-800",children:[a+1,". ",t.p.name]}),e.jsxs("td",{className:"py-3 px-3 text-center",children:[t.count,"ê±´"]}),e.jsxs("td",{className:"py-3 px-3 text-right font-bold",children:[t.revenue.toLocaleString(),"ë§Œì›"]}),e.jsxs("td",{className:"py-3 px-3 text-right text-blue-600",children:[t.paid.toLocaleString(),"ë§Œì›"]}),e.jsxs("td",{className:"py-3 px-3 text-right text-orange-600",children:[t.unpaid.toLocaleString(),"ë§Œì›"]}),e.jsxs("td",{className:"py-3 px-3 text-right text-gray-500",children:[t.rate,"%"]})]},t.p.partnerId))})]})})]}),(()=>{const t=new Date,a=t.toISOString().split("T")[0],r=[];V.filter(d=>d.partnerId===p).forEach(d=>{if(!d.depositHistory||d.depositHistory.length===0||!b)return;nt(b,d.contractFee||0);let j=0;d.depositHistory.forEach((h,v)=>{if(!h.date||h.date<=a){j+=h.amount||0;return}const A=(b==null?void 0:b.commissionRules)||[],u=b==null?void 0:b.settlementConfig,H=d.depositHistory.filter((Qe,Gs)=>Qe.date&&Qe.date<=a),ee={...d,depositHistory:H},te=lt(ee,A,u).payable;j+=h.amount||0;const ie={...d,depositHistory:d.depositHistory.slice(0,v+1)},$e=lt(ie,A,u),fe=Math.max(0,$e.payable-te),ce=new Date(h.date),D=ce.getDay(),W=new Date(ce);W.setDate(W.getDate()+(7-D)),W.setDate(W.getDate()+2),r.push({caseId:d.caseId,customerName:d.customerName,depositDate:h.date,amount:h.amount||0,depositNumber:v+1,contractFee:d.contractFee||0,totalDeposited:j,expectedPayout:fe,payoutDate:W.toISOString().split("T")[0]})})}),r.sort((d,j)=>d.depositDate.localeCompare(j.depositDate));const l=new Date(t);l.setDate(l.getDate()+60);const c=l.toISOString().split("T")[0],g=r.filter(d=>d.depositDate<=c),w=g.reduce((d,j)=>d+j.amount,0),C=g.reduce((d,j)=>d+j.expectedPayout,0);return g.length===0?e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-2xl",children:"ðŸ”®"}),e.jsx("h3",{className:"font-bold text-gray-700",children:"ë¯¸ëž˜ ìž…ê¸ˆ/ì§€ê¸‰ ì˜ˆì¸¡"})]}),e.jsx("p",{className:"text-gray-400 text-sm",children:"í–¥í›„ 60ì¼ ë‚´ ì˜ˆì •ëœ ìž…ê¸ˆì´ ì—†ìŠµë‹ˆë‹¤."})]}):e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-gray-100 bg-gradient-to-r from-amber-50 to-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:"ðŸ”®"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-gray-700",children:"ë¯¸ëž˜ ìž…ê¸ˆ/ì§€ê¸‰ ì˜ˆì¸¡"}),e.jsx("p",{className:"text-xs text-gray-500",children:"í–¥í›„ 60ì¼ ë‚´ ì˜ˆì •ëœ ìž…ê¸ˆê³¼ ìˆ˜ìˆ˜ë£Œ ì§€ê¸‰ ì¼ì •"})]})]}),e.jsxs("div",{className:"flex gap-4 text-sm",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"ì˜ˆìƒ ìž…ê¸ˆ"}),e.jsxs("p",{className:"font-bold text-green-600",children:[w.toLocaleString(),"ë§Œì›"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"ì˜ˆìƒ ì§€ê¸‰"}),e.jsxs("p",{className:"font-bold text-orange-600",children:[C.toLocaleString(),"ë§Œì›"]})]})]})]})}),e.jsx("div",{className:"p-4",children:e.jsx("div",{className:"space-y-3",children:g.map((d,j)=>e.jsxs("div",{className:"flex items-start gap-4 p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsxs("div",{className:"flex-shrink-0 text-center",children:[e.jsx("div",{className:"bg-blue-100 text-blue-700 px-3 py-1 rounded-lg font-bold text-sm",children:new Date(d.depositDate).toLocaleDateString("ko-KR",{month:"short",day:"numeric"})}),e.jsx("p",{className:"text-[10px] text-gray-400 mt-1",children:"ìž…ê¸ˆì˜ˆì •"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-gray-800",children:d.customerName}),e.jsxs("span",{className:"text-xs bg-blue-50 text-blue-600 px-2 py-0.5 rounded-full",children:[d.depositNumber,"ì°¨ ìž…ê¸ˆ"]})]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["ìˆ˜ìž„ë£Œ ",d.contractFee,"ë§Œì› ì¤‘ ëˆ„ì  ",d.totalDeposited,"ë§Œì› ìž…ê¸ˆ"]})]}),e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsxs("p",{className:"font-bold text-green-600 text-lg",children:["+",d.amount.toLocaleString(),"ë§Œì›"]}),d.expectedPayout>0&&e.jsx("div",{className:"mt-1 text-xs",children:e.jsxs("span",{className:"text-orange-600",children:["â†’ ",d.payoutDate.slice(5).replace("-","/")," ìˆ˜ìˆ˜ë£Œ ",d.expectedPayout,"ë§Œì›"]})})]})]},`${d.caseId}-${d.depositNumber}`))})})]})})(),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-gray-100 bg-gradient-to-r from-indigo-50 to-white flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-gray-700",children:"ðŸ“‹ ì£¼ê°„ ì •ì‚° ë°°ì¹˜ í˜„í™©"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"ìµœê·¼ ì •ì‚° ë°°ì¹˜ë³„ ìˆ˜ê¸ˆ/ì§€ê¸‰/ì„¸ê¸ˆê³„ì‚°ì„œ ìƒíƒœ"})]}),e.jsxs("button",{onClick:()=>{const t=Array.isArray($)?$:[];if(t.length===0){i("ë‚´ë³´ë‚¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.","error");return}const a=t.map(r=>{var s,l;return{ì£¼ì°¨:r.weekLabel,ê¸°ê°„:`${r.startDate} ~ ${r.endDate}`,"ìˆ˜ìˆ˜ë£Œ(ë§Œì›)":r.totalCommission,ìˆ˜ê¸ˆìƒíƒœ:(s=r.collectionInfo)!=null&&s.collectedAt?`ì™„ë£Œ (${r.collectionInfo.collectedAt})`:"ëŒ€ê¸°","íŒŒíŠ¸ë„ˆ ì§€ê¸‰":(r.payoutItems||[]).length>0?(r.payoutItems||[]).map(c=>`${c.partnerName}(${c.amount}ë§Œì›)`).join(", "):"ì—†ìŒ",ì„¸ê¸ˆê³„ì‚°ì„œ:(l=r.purchaseInvoice)!=null&&l.receivedAt?`ìˆ˜ì·¨ (${r.purchaseInvoice.receivedAt})`:"ë¯¸ìˆ˜ì·¨",ìƒíƒœ:ve(r.status)}});Zs(`ì •ì‚°ë‚´ì—­_${new Date().toISOString().split("T")[0]}`,a),i("ì—‘ì…€ íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.","success")},className:"flex items-center gap-1.5 px-3 py-1.5 bg-green-600 text-white rounded-lg text-sm font-medium hover:bg-green-700 transition-colors",children:[e.jsx(Ds,{size:16}),"ì—‘ì…€ ë‹¤ìš´ë¡œë“œ"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-600 font-medium",children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-3 px-3 text-left",children:"ì£¼ì°¨"}),e.jsx("th",{className:"py-3 px-3 text-right",children:"ìˆ˜ìˆ˜ë£Œ"}),e.jsx("th",{className:"py-3 px-3 text-center",children:"ìˆ˜ê¸ˆ"}),e.jsx("th",{className:"py-3 px-3 text-center",children:"íŒŒíŠ¸ë„ˆ ì§€ê¸‰"}),e.jsx("th",{className:"py-3 px-3 text-center",children:"ë§¤ìž…ì„¸ê¸ˆê³„ì‚°ì„œ"}),e.jsx("th",{className:"py-3 px-3 text-center",children:"ìƒíƒœ"})]})}),e.jsx("tbody",{children:(Array.isArray($)?$:[]).slice(0,8).map(t=>{var l,c,g;const a=(t.payoutItems||[]).length,r=(t.payoutItems||[]).filter(w=>w.paidAt).length,s=(t.payoutItems||[]).reduce((w,C)=>w+(C.amount||0),0);return e.jsxs("tr",{className:"border-b border-gray-50 last:border-0 hover:bg-gray-50",children:[e.jsx("td",{className:"py-3 px-3 font-medium",children:t.weekLabel}),e.jsxs("td",{className:"py-3 px-3 text-right font-bold text-blue-600",children:[t.totalCommission.toLocaleString(),"ë§Œì›"]}),e.jsx("td",{className:"py-3 px-3 text-center",children:(l=t.collectionInfo)!=null&&l.collectedAt?e.jsxs("span",{className:"px-2 py-1 bg-green-100 text-green-700 rounded-full text-xs font-medium",children:["âœ“ ",(c=t.collectionInfo.amount)==null?void 0:c.toLocaleString(),"ë§Œì›"]}):e.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-500 rounded-full text-xs",children:"ëŒ€ê¸°"})}),e.jsx("td",{className:"py-3 px-3 text-center",children:a>0?e.jsxs("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${r===a?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"}`,children:[r,"/",a,"ê±´ (",s,"ë§Œì›)"]}):e.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-400 rounded-full text-xs",children:"ì—†ìŒ"})}),e.jsx("td",{className:"py-3 px-3 text-center",children:(g=t.purchaseInvoice)!=null&&g.receivedAt?e.jsx("span",{className:"px-2 py-1 bg-purple-100 text-purple-700 rounded-full text-xs font-medium",children:"âœ“ ìˆ˜ì·¨ì™„ë£Œ"}):e.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-500 rounded-full text-xs",children:"ë¯¸ìˆ˜ì·¨"})}),e.jsx("td",{className:"py-3 px-3 text-center",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium
                                                ${t.status==="completed"?"bg-green-100 text-green-700":t.status==="paid"?"bg-blue-100 text-blue-700":t.status==="collected"?"bg-teal-100 text-teal-700":"bg-gray-100 text-gray-600"}`,children:ve(t.status)})})]},t.batchId)})})]})})]}),(()=>{const t=Array.isArray($)?$:[],a={};t.forEach(s=>{(s.payoutItems||[]).forEach(l=>{const c=l.partnerName||"ë¯¸ì§€ì •";a[c]||(a[c]={total:0,paid:0,count:0}),a[c].total+=l.amount||0,a[c].count+=1,l.paidAt&&(a[c].paid+=l.amount||0)})});const r=Object.entries(a).sort((s,l)=>l[1].total-s[1].total);return r.length===0?null:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-gray-100 bg-gradient-to-r from-green-50 to-white",children:[e.jsx("h3",{className:"font-bold text-gray-700",children:"ðŸ’³ íŒŒíŠ¸ë„ˆë³„ ì§€ê¸‰ í˜„í™©"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"ì „ì²´ ì •ì‚° ê¸°ê°„ íŒŒíŠ¸ë„ˆ ì§€ê¸‰ ëˆ„ê³„"})]}),e.jsx("div",{className:"p-4 grid gap-3",children:r.map(([s,l])=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:"ðŸ¢"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-800",children:s}),e.jsxs("p",{className:"text-xs text-gray-500",children:[l.count,"ê±´"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-bold text-green-600",children:[l.paid.toLocaleString(),"ë§Œì› ",e.jsx("span",{className:"text-gray-400 font-normal",children:"ì§€ê¸‰"})]}),l.total>l.paid&&e.jsxs("p",{className:"text-xs text-orange-600",children:[(l.total-l.paid).toLocaleString(),"ë§Œì› ë¯¸ì§€ê¸‰"]})]})]},s))})]})})(),Ue>0&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4 flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:"âš ï¸"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-bold text-red-700",children:["ê³„ì•½ì¼ ëˆ„ë½: ",Ue,"ê±´"]}),e.jsx("p",{className:"text-sm text-red-600",children:"ê³„ì•½ì¼ì´ ì—†ëŠ” ê±´ì€ ì •ì‚° ì§‘ê³„ì—ì„œ ì œì™¸ë©ë‹ˆë‹¤."})]})]}),e.jsx(Ks,{batches:$})]}),Xe={ê´‘ê³ ë¹„:"#ef4444",ë§ˆì¼€íŒ…ë¹„:"#f97316",ì‚¬ë¬´ë¹„ìš©:"#eab308",ì¸ê±´ë¹„:"#22c55e",êµí†µë¹„:"#3b82f6",ì‹ëŒ€:"#8b5cf6",ê¸°íƒ€:"#6b7280"},zt=async()=>{if(!M.amount||!M.description){i("ê¸ˆì•¡ê³¼ ë‚´ìš©ì„ ìž…ë ¥í•´ì£¼ì„¸ìš”.","error");return}he?(await as(he.id,M),i("ì§€ì¶œì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.","success")):(await rs({...M,partnerId:p!=="all"?p:void 0}),i("ì§€ì¶œì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.","success"));const[t,a]=await Promise.all([Ee(p,I),Me(I,N,p)]);re(t),De(a),ne(!1),le(null),U({category:"ê´‘ê³ ë¹„",amount:0,description:"",date:new Date().toISOString().split("T")[0]})},Bt=async t=>{if(!confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?"))return;await os(t),i("ì§€ì¶œì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.","success");const[a,r]=await Promise.all([Ee(p,I),Me(I,N,p)]);re(a),De(r)},_t=t=>{le(t),U({date:t.date,category:t.category,amount:t.amount,description:t.description,memo:t.memo}),ne(!0)},Yt=()=>{const t=Fe-ye-B.total,a=N==="all"?B.total:J.filter(s=>s.date&&s.date.startsWith(`${I}-${String(N).padStart(2,"0")}`)).reduce((s,l)=>s+(l.amount||0),0),r=Object.entries(B.byCategory).filter(([s,l])=>l>0).map(([s,l])=>({name:s,value:l,color:Xe[s]}));return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-red-50 to-white p-5 rounded-xl shadow-sm border border-red-200",children:[e.jsx("p",{className:"text-sm text-red-700",children:"ðŸ’¸ ì´ ì§€ì¶œ"}),e.jsxs("p",{className:"text-2xl font-bold text-red-600 mt-1",children:[B.total.toLocaleString(),"ë§Œì›"]}),e.jsxs("p",{className:"text-xs text-red-500 mt-1",children:[I,"ë…„ ëˆ„ì "]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-orange-50 to-white p-5 rounded-xl shadow-sm border border-orange-200",children:[e.jsx("p",{className:"text-sm text-orange-700",children:"ðŸ“… ì´ë²ˆ ë‹¬ ì§€ì¶œ"}),e.jsxs("p",{className:"text-2xl font-bold text-orange-600 mt-1",children:[a.toLocaleString(),"ë§Œì›"]}),e.jsx("p",{className:"text-xs text-orange-500 mt-1",children:N==="all"?"ì „ì²´ ì›”":`${N}ì›”`})]}),e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-white p-5 rounded-xl shadow-sm border border-blue-200",children:[e.jsx("p",{className:"text-sm text-blue-700",children:"ðŸ“Š ê´‘ê³ ë¹„ ë¹„ì¤‘"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600 mt-1",children:[B.total>0?Math.round(B.byCategory.ê´‘ê³ ë¹„/B.total*100):0,"%"]}),e.jsxs("p",{className:"text-xs text-blue-500 mt-1",children:[B.byCategory.ê´‘ê³ ë¹„.toLocaleString(),"ë§Œì›"]})]}),e.jsxs("div",{className:`bg-gradient-to-br ${t>=0?"from-green-50 to-white border-green-200":"from-red-50 to-white border-red-200"} p-5 rounded-xl shadow-sm border`,children:[e.jsx("p",{className:`text-sm ${t>=0?"text-green-700":"text-red-700"}`,children:"ðŸ’° ìˆœì´ìµ"}),e.jsxs("p",{className:`text-2xl font-bold mt-1 ${t>=0?"text-green-600":"text-red-600"}`,children:[t.toLocaleString(),"ë§Œì›"]}),e.jsx("p",{className:`text-xs mt-1 ${t>=0?"text-green-500":"text-red-500"}`,children:"ìž…ê¸ˆ - ìˆ˜ìˆ˜ë£Œ - ì§€ì¶œ"})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{onClick:()=>{le(null),U({category:"ê´‘ê³ ë¹„",amount:0,description:"",date:new Date().toISOString().split("T")[0]}),ne(!0)},className:"bg-red-600 text-white px-4 py-2 rounded-lg font-bold hover:bg-red-700 flex items-center gap-2",children:[e.jsx(mt,{size:18})," ì§€ì¶œ ë“±ë¡"]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-100",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-700 mb-4",children:"ðŸ“Š ì¹´í…Œê³ ë¦¬ë³„ ì§€ì¶œ"}),r.length>0?e.jsxs("div",{className:"flex items-center",children:[e.jsx(Oe,{width:"50%",height:200,children:e.jsxs(hs,{children:[e.jsx(us,{data:r,cx:"50%",cy:"50%",innerRadius:40,outerRadius:80,paddingAngle:2,dataKey:"value",children:r.map((s,l)=>e.jsx(gs,{fill:s.color},`cell-${l}`))}),e.jsx(He,{formatter:s=>[`${Number(s).toLocaleString()}ë§Œì›`,""]})]})}),e.jsx("div",{className:"flex-1 space-y-2",children:r.map((s,l)=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:s.color}}),e.jsx("span",{children:s.name})]}),e.jsxs("span",{className:"font-medium",children:[s.value.toLocaleString(),"ë§Œì›"]})]},l))})]}):e.jsx("div",{className:"h-48 flex items-center justify-center text-gray-400",children:"ì§€ì¶œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤"})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-100",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-700 mb-4",children:"ðŸ“ˆ ì›”ë³„ ì§€ì¶œ ì¶”ì´"}),e.jsx(Oe,{width:"100%",height:200,children:e.jsxs(dt,{data:B.byMonth,children:[e.jsx(it,{strokeDasharray:"3 3",vertical:!1}),e.jsx(ct,{dataKey:"month"}),e.jsx(xt,{}),e.jsx(He,{formatter:s=>[`${s.toLocaleString()}ë§Œì›`,"ì§€ì¶œ"]}),e.jsx(We,{dataKey:"amount",fill:"#ef4444",radius:[4,4,0,0]})]})})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-gray-100 bg-gray-50 flex justify-between items-center",children:[e.jsx("h3",{className:"font-bold text-gray-700",children:"ðŸ“‹ ì§€ì¶œ ë‚´ì—­"}),e.jsxs("span",{className:"text-sm text-gray-500",children:[J.length,"ê±´"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-600 font-medium",children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-3 px-3 text-left",children:"ë‚ ì§œ"}),e.jsx("th",{className:"py-3 px-3 text-left",children:"ì¹´í…Œê³ ë¦¬"}),e.jsx("th",{className:"py-3 px-3 text-left",children:"ë‚´ìš©"}),e.jsx("th",{className:"py-3 px-3 text-right",children:"ê¸ˆì•¡"}),e.jsx("th",{className:"py-3 px-3 text-center",children:"ê´€ë¦¬"})]})}),e.jsx("tbody",{children:z?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"py-8 text-center text-gray-400",children:"ë¡œë”©ì¤‘..."})}):J.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"py-8 text-center text-gray-400",children:"ë“±ë¡ëœ ì§€ì¶œì´ ì—†ìŠµë‹ˆë‹¤"})}):J.slice(0,20).map(s=>e.jsxs("tr",{className:"border-b border-gray-50 hover:bg-gray-50",children:[e.jsx("td",{className:"py-3 px-3 text-gray-600",children:s.date}),e.jsx("td",{className:"py-3 px-3",children:e.jsx("span",{className:"px-2 py-1 rounded text-xs font-medium text-white",style:{backgroundColor:Xe[s.category]},children:s.category})}),e.jsxs("td",{className:"py-3 px-3 text-gray-800",children:[s.description,s.memo&&e.jsxs("span",{className:"text-gray-400 ml-2 text-xs",children:["(",s.memo,")"]})]}),e.jsxs("td",{className:"py-3 px-3 text-right font-bold text-red-600",children:[s.amount.toLocaleString(),"ë§Œì›"]}),e.jsxs("td",{className:"py-3 px-3 text-center",children:[e.jsx("button",{onClick:()=>_t(s),className:"text-blue-600 hover:text-blue-700 mr-2",children:"ìˆ˜ì •"}),e.jsx("button",{onClick:()=>Bt(s.id),className:"text-red-500 hover:text-red-700",children:e.jsx(pt,{size:14})})]})]},s.id))})]})})]})]})},qe=new Date,Pe=qe.getDay(),Je=V.filter(t=>{var l;if(t.status==="ì¢…ê²°"||t.status==="ì·¨ì†Œ")return!1;const a=(t.depositHistory||[]).reduce((c,g)=>c+(g.amount||0),0);if((t.contractFee||0)-a<=0)return!1;const s=(l=t.depositHistory)!=null&&l.length?t.depositHistory.map(c=>c.date).sort().pop():t.contractAt||t.createdAt;return s?ze(qe,we(s))>=30:!1}).length;let K=null;return Pe===1?n?n.status==="draft"&&(K={type:"info",msg:"ì •ì‚° ë‚´ì—­ì„ í™•ì¸í•˜ê³  í™•ì •(Confirmed)í•´ì£¼ì„¸ìš”."}):K={type:"warning",msg:"ì›”ìš”ì¼ìž…ë‹ˆë‹¤. ê¸ˆì£¼ ì •ì‚° ë°°ì¹˜ë¥¼ ìƒì„±í•˜ê³  í™•ì¸í•´ì£¼ì„¸ìš”."}:Pe===2?n&&!n.invoiceInfo&&(K={type:"warning",msg:"í™”ìš”ì¼ìž…ë‹ˆë‹¤. ì„¸ê¸ˆê³„ì‚°ì„œ ë°œí–‰ ë° ìˆ˜ê¸ˆ í™•ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤."}):Pe===3&&n&&n.status!=="completed"&&n.status!=="paid"&&(K={type:"warning",msg:"ìˆ˜ìš”ì¼ìž…ë‹ˆë‹¤. íŒŒíŠ¸ë„ˆ ìˆ˜ìˆ˜ë£Œ ì§€ê¸‰ì„ ì§„í–‰í•´ì£¼ì„¸ìš”."}),e.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"ì£¼ê°„ì •ì‚°ì„¼í„°"}),e.jsx("div",{className:"flex gap-2 items-center flex-wrap",children:e.jsxs("div",{className:"relative",children:[e.jsxs("select",{className:"bg-white border p-2 pl-9 rounded text-lg font-bold text-indigo-700 min-w-[200px] outline-none cursor-pointer",value:p,onChange:t=>L(t.target.value),children:[e.jsx("option",{value:"all",children:"ì „ì²´ í†µê³„ (Total)"}),x.map(t=>e.jsx("option",{value:t.partnerId,children:t.name},t.partnerId))]}),e.jsx(js,{className:"absolute left-3 top-3 text-indigo-500",size:18})]})})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[Je>0&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 flex items-center justify-between animate-pulse",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-700",children:[e.jsx("span",{className:"font-bold",children:"ðŸš¨ ê¸´ê¸‰"}),e.jsxs("span",{className:"text-sm",children:["í˜„ìž¬ 30ì¼ ì´ìƒ ìž¥ê¸° ë¯¸ìˆ˜ê¸ˆ ê±´ì´ ",e.jsxs("span",{className:"font-bold underline",children:[Je,"ê±´"]})," ìžˆìŠµë‹ˆë‹¤."]})]}),e.jsx("button",{onClick:()=>{f("report")},className:"text-xs bg-red-100 text-red-700 px-2 py-1 rounded font-bold hover:bg-red-200",children:"í™•ì¸í•˜ê¸°"})]}),K&&e.jsxs("div",{className:`border rounded-lg p-3 flex items-center gap-2 ${K.type==="warning"?"bg-orange-50 border-orange-200 text-orange-800":"bg-blue-50 border-blue-200 text-blue-800"}`,children:[e.jsx("span",{children:K.type==="warning"?"âš ï¸":"â„¹ï¸"}),e.jsx("span",{className:"text-sm font-medium",children:K.msg})]})]}),T!=="report"&&!_&&e.jsxs("div",{className:"bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:vt,className:"p-2 hover:bg-gray-100 rounded",children:e.jsx(yt,{size:20})}),e.jsxs("div",{className:"text-center min-w-[200px]",children:[e.jsx("p",{className:"font-bold text-lg text-gray-800",children:ke}),e.jsxs("p",{className:"text-sm text-gray-500",children:[S.toLocaleDateString("ko-KR")," ~ ",Qt(S).toLocaleDateString("ko-KR")]})]}),e.jsx("button",{onClick:wt,className:"p-2 hover:bg-gray-100 rounded",children:e.jsx(ft,{size:20})})]}),e.jsx("button",{onClick:It,className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"ì´ë²ˆ ì£¼ë¡œ ì´ë™"})]}),e.jsxs("div",{className:"flex border-b border-gray-200 overflow-x-auto",children:[!_&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>f("monday"),className:`px-6 py-3 font-medium text-sm whitespace-nowrap border-b-2 transition-colors ${T==="monday"?"border-blue-600 text-blue-600 bg-blue-50":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"ðŸ“… ì›”ìš”ì¼ (í™•ì¸)"}),e.jsx("button",{onClick:()=>f("tuesday"),className:`px-6 py-3 font-medium text-sm whitespace-nowrap border-b-2 transition-colors ${T==="tuesday"?"border-yellow-600 text-yellow-600 bg-yellow-50":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"ðŸ“„ í™”ìš”ì¼ (ë°œí–‰/ìˆ˜ê¸ˆ)"}),e.jsx("button",{onClick:()=>f("wednesday"),className:`px-6 py-3 font-medium text-sm whitespace-nowrap border-b-2 transition-colors ${T==="wednesday"?"border-green-600 text-green-600 bg-green-50":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"ðŸ’° ìˆ˜ìš”ì¼ (ì§€ê¸‰)"})]}),e.jsx("button",{onClick:()=>f("report"),className:`px-6 py-3 font-medium text-sm whitespace-nowrap border-b-2 transition-colors ${T==="report"?"border-purple-600 text-purple-600 bg-purple-50":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"ðŸ“Š ë¦¬í¬íŠ¸"}),e.jsx("button",{onClick:()=>f("expenses"),className:`px-6 py-3 font-medium text-sm whitespace-nowrap border-b-2 transition-colors ${T==="expenses"?"border-red-600 text-red-600 bg-red-50":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"ðŸ’³ ì§€ì¶œ"})]}),(T==="report"||T==="expenses")&&e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("select",{className:"bg-white border p-2 rounded text-lg font-bold cursor-pointer min-w-[100px]",value:I,onChange:t=>P(Number(t.target.value)),children:Array.from({length:13},(t,a)=>2024+a).map(t=>e.jsxs("option",{value:t,children:[t,"ë…„"]},t))}),e.jsxs("select",{className:"bg-white border p-2 rounded text-lg font-bold cursor-pointer min-w-[100px]",value:N,onChange:t=>G(t.target.value==="all"?"all":Number(t.target.value)),children:[e.jsx("option",{value:"all",children:"ì „ì²´ ì›”"}),Array.from({length:12},(t,a)=>a+1).map(t=>e.jsxs("option",{value:t,children:[t,"ì›”"]},t))]})]}),T==="monday"&&!_&&Ot(),T==="tuesday"&&!_&&Ht(),T==="wednesday"&&!_&&Wt(),T==="report"&&Rt(),T==="expenses"&&Yt(),_&&T!=="report"&&T!=="expenses"&&e.jsxs("div",{className:"bg-gray-50 p-8 rounded-xl text-center",children:[e.jsx("p",{className:"text-gray-500",children:"ì£¼ê°„ ì •ì‚° ê¸°ëŠ¥ì€ íŠ¹ì • ê±°ëž˜ì²˜ë¥¼ ì„ íƒí•´ì•¼ ì‚¬ìš©í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤."}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:'í†µê³„ë¥¼ ë³´ì‹œë ¤ë©´ "ë¦¬í¬íŠ¸" íƒ­ì„ ì„ íƒí•˜ì„¸ìš”.'})]}),e.jsxs(ot,{isOpen:me,onClose:()=>se(!1),title:`${I}ë…„ ${N==="all"?"ì „ì²´":N+"ì›”"} ê³„ì•½ ë° ì •ì‚° ìƒì„¸ ë‚´ì—­`,children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left whitespace-nowrap",children:[e.jsx("thead",{className:"bg-gray-100 text-gray-700 font-bold",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2",children:"ê³„ì•½ì¼"}),e.jsx("th",{className:"px-4 py-2",children:"ê³ ê°ëª…"}),e.jsx("th",{className:"px-4 py-2",children:"ê±°ëž˜ì²˜"}),e.jsx("th",{className:"px-4 py-2",children:"ìƒíƒœ"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"ìˆ˜ìž„ë£Œ"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"ìˆ˜ë‹¹(Rule)"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:R.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-4 py-8 text-center text-gray-500",children:"í•´ë‹¹ ê¸°ê°„ì— ì™„ë£Œëœ ê³„ì•½ ê±´ì´ ì—†ìŠµë‹ˆë‹¤."})}):R.sort((t,a)=>(a.contractAt||"").localeCompare(t.contractAt||"")).map(t=>{var r;const a=ue(t);return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2 text-gray-600",children:t.contractAt}),e.jsx("td",{className:"px-4 py-2 font-medium text-gray-900",children:t.customerName}),e.jsx("td",{className:"px-4 py-2 text-gray-500",children:Mt(t.partnerId)}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("span",{className:"px-2 py-0.5 rounded text-xs bg-gray-100 text-gray-600 border border-gray-200",children:t.status})}),e.jsxs("td",{className:"px-4 py-2 text-right text-blue-600 font-medium",children:[(r=t.contractFee)==null?void 0:r.toLocaleString(),"ë§Œì›"]}),e.jsxs("td",{className:"px-4 py-2 text-right text-green-600 font-bold",children:[a.toLocaleString(),"ë§Œì›"]})]},t.caseId)})}),R.length>0&&e.jsx("tfoot",{className:"bg-gray-50 font-bold",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:4,className:"px-4 py-2 text-center text-gray-700",children:"í•©ê³„"}),e.jsxs("td",{className:"px-4 py-2 text-right text-blue-700",children:[Le.toLocaleString(),"ë§Œì›"]}),e.jsxs("td",{className:"px-4 py-2 text-right text-green-700",children:[Te.toLocaleString(),"ë§Œì›"]})]})})]})}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx("button",{onClick:()=>se(!1),className:"px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 text-sm font-medium",children:"ë‹«ê¸°"})})]}),e.jsx(ot,{isOpen:Nt,onClose:()=>{ne(!1),le(null)},title:he?"ì§€ì¶œ ìˆ˜ì •":"ì§€ì¶œ ë“±ë¡",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ë‚ ì§œ"}),e.jsx("input",{type:"date",className:"w-full border rounded-lg p-2",value:M.date||"",onChange:t=>U({...M,date:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ì¹´í…Œê³ ë¦¬"}),e.jsx("select",{className:"w-full border rounded-lg p-2",value:M.category||"ê´‘ê³ ë¹„",onChange:t=>U({...M,category:t.target.value}),children:es.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ê¸ˆì•¡ (ë§Œì›)"}),e.jsx("input",{type:"number",className:"w-full border rounded-lg p-2",placeholder:"ì˜ˆ: 100",value:M.amount||"",onChange:t=>U({...M,amount:Number(t.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ë‚´ìš© *"}),e.jsx("input",{type:"text",className:"w-full border rounded-lg p-2",placeholder:"ì˜ˆ: ë„¤ì´ë²„ ê´‘ê³ ë¹„",value:M.description||"",onChange:t=>U({...M,description:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ë©”ëª¨ (ì„ íƒ)"}),e.jsx("textarea",{className:"w-full border rounded-lg p-2",rows:2,placeholder:"ì¶”ê°€ ë©”ëª¨",value:M.memo||"",onChange:t=>U({...M,memo:t.target.value})})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx("button",{onClick:zt,className:"flex-1 bg-red-600 text-white py-2 rounded-lg font-bold hover:bg-red-700",children:he?"ìˆ˜ì •":"ë“±ë¡"}),e.jsx("button",{onClick:()=>{ne(!1),le(null)},className:"flex-1 bg-gray-200 text-gray-700 py-2 rounded-lg font-medium hover:bg-gray-300",children:"ì·¨ì†Œ"})]})]})})]})}export{ha as default};
