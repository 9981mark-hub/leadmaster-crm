import{r as c,b as T,d as Y,j as e,P as K}from"./index-DzXtev1P.js";import{c as D,h as O}from"./utils-CYKccps_.js";import{M as W}from"./Modal-BAptuuHF.js";import{B as z}from"./building-B__TPUZ5.js";import{ay as _,ar as G,as as X,at as q,au as H,av as J,aw as Q,ax as I}from"./BarChart-DKVj_976.js";import{S as U}from"./search-Cp1jN8nj.js";function re(){const[h,A]=c.useState([]),[m,$]=c.useState([]),[g,b]=c.useState(""),[p,L]=c.useState(new Date().getFullYear()),[l,M]=c.useState("all"),[P,F]=c.useState(!0),[k,u]=c.useState(!1);if(c.useEffect(()=>{Promise.all([T(),Y()]).then(([t,s])=>{A(t),$(s),s.length>0&&b(s[0].partnerId),F(!1)})},[]),P)return e.jsx("div",{children:"ë¡œë”©ì¤‘..."});const i=g==="all",r=i?null:m.find(t=>t.partnerId===g),j=i?h:h.filter(t=>t.partnerId===g),f=t=>{const s=m.find(a=>a.partnerId===t.partnerId);return s?O(t.contractFee||0,s.commissionRules):0},d=j.filter(t=>{if(!t.contractAt)return!1;const s=new Date(t.contractAt),a=s.getFullYear(),n=s.getMonth()+1;return a===p&&(l==="all"||n===l)}),E=d.length,N=d.reduce((t,s)=>t+(s.contractFee||0),0),v=d.reduce((t,s)=>t+f(s),0),B=j.filter(t=>["ê³„ì•½ ì™„ë£Œ","1ì°¨ ìž…ê¸ˆì™„ë£Œ","2ì°¨ ìž…ê¸ˆì™„ë£Œ"].includes(t.status)&&!t.contractAt).length,w=Array.from({length:12},(t,s)=>{const a=`${p}-${String(s+1).padStart(2,"0")}`,n=j.filter(x=>x.contractAt&&x.contractAt.startsWith(a)),C=n.reduce((x,y)=>x+(y.contractFee||0),0),S=n.reduce((x,y)=>x+f(y),0);return{name:`${s+1}ì›”`,count:n.length,revenue:C,commission:S}});let o=null;if(i){let t=0,s=0;m.forEach(a=>{const n=D(h,a);t+=n.currentTotalDeposit,s+=n.expectedCommission}),o={currentTotalDeposit:t,expectedCommission:s,isEligible:s>0,title:"ì „ì²´ ê±°ëž˜ì²˜ í•©ì‚°",desc:"ëª¨ë“  ê±°ëž˜ì²˜ì˜ ë‹¤ìŒ ì •ì‚° ì˜ˆì • ê¸ˆì•¡ í•©ê³„ìž…ë‹ˆë‹¤."}}else if(r){const t=D(h,r);o={...t,title:`ë‹¤ìŒ ì •ì‚° ìš”ì•½ (${r.name})`,desc:`ë§¤ì£¼ ${t.cutoffDayName}ìš”ì¼ ë§ˆê°, ${r.settlementConfig.payoutWeekDelay===0?"ê¸ˆì£¼":"ì°¨ì£¼"} ${t.payoutDayName}ìš”ì¼(${t.payoutDate}) ì§€ê¸‰`}}const R=t=>{var s;return((s=m.find(a=>a.partnerId===t))==null?void 0:s.name)||"-"};return e.jsxs("div",{className:"max-w-6xl mx-auto space-y-8",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"ì •ì‚° ë¦¬í¬íŠ¸"}),e.jsxs("div",{className:"flex gap-2 items-center flex-wrap",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("select",{className:"bg-white border p-2 pl-9 rounded text-lg font-bold text-indigo-700 min-w-[200px] outline-none cursor-pointer",value:g,onChange:t=>b(t.target.value),children:[e.jsx("option",{value:"all",children:"ì „ì²´ í†µê³„ (Total)"}),m.map(t=>e.jsx("option",{value:t.partnerId,children:t.name},t.partnerId))]}),e.jsx(z,{className:"absolute left-3 top-3 text-indigo-500",size:18})]}),e.jsxs("select",{className:"bg-white border p-2 rounded text-lg font-bold cursor-pointer min-w-[100px]",value:p,onChange:t=>L(Number(t.target.value)),children:[e.jsx("option",{value:2024,children:"2024ë…„"}),e.jsx("option",{value:2025,children:"2025ë…„"})]}),e.jsxs("select",{className:"bg-white border p-2 rounded text-lg font-bold cursor-pointer min-w-[100px]",value:l,onChange:t=>M(t.target.value==="all"?"all":Number(t.target.value)),children:[e.jsx("option",{value:"all",children:"ì „ì²´ ì›”"}),Array.from({length:12},(t,s)=>s+1).map(t=>e.jsxs("option",{value:t,children:[t,"ì›”"]},t))]})]})]}),o&&e.jsxs("div",{className:"rounded-xl shadow-sm border p-6 bg-green-50 border-green-200",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-bold flex items-center text-green-800",children:[i?e.jsx(_,{className:"mr-2"}):e.jsx(K,{className:"mr-2"}),o.title]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:o.desc})]}),e.jsxs("div",{className:"min-w-[200px] text-right",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"ì •ì‚° ëŒ€ìƒ ëˆ„ì  ìž…ê¸ˆì•¡"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[o.currentTotalDeposit.toLocaleString(),"ë§Œì›"]}),e.jsxs("p",{className:"text-lg text-green-700 font-bold mt-1",children:["ì§€ê¸‰ ì˜ˆì • ìˆ˜ë‹¹: ",o.expectedCommission.toLocaleString(),"ë§Œì›"]})]})]}),!i&&r&&e.jsxs("div",{className:"mt-4 bg-white/50 p-3 rounded-lg text-xs text-gray-600",children:[e.jsx("p",{children:"ðŸ’¡ ì§€ê¸‰ ê¸°ì¤€ ì•ˆë‚´:"}),e.jsxs("ul",{className:"list-disc pl-4 mt-1 space-y-1",children:[e.jsx("li",{children:"ì™„ë‚© ê¸°ì¤€ì•¡ ì´ìƒ ìž…ê¸ˆ: ìˆ˜ë‹¹ 100% ì§€ê¸‰"}),e.jsxs("li",{children:["ê³„ì•½ê¸ˆ(",r.settlementConfig.downPaymentPercentage,"%) ì´ìƒ ìž…ê¸ˆ: ìˆ˜ë‹¹ ",r.settlementConfig.firstPayoutPercentage,"% ì„ ì§€ê¸‰"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{onClick:()=>u(!0),className:"bg-white p-6 rounded-xl shadow-sm border border-gray-100 cursor-pointer hover:bg-gray-50 hover:border-blue-300 transition-all group",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("p",{className:"text-sm text-gray-500",children:["ì´ ê³„ì•½ ê±´ìˆ˜ (",l==="all"?"ì—°ê°„":`${l}ì›”`,")"]}),e.jsx(U,{size:16,className:"text-gray-300 group-hover:text-blue-500"})]}),e.jsxs("p",{className:"text-3xl font-bold text-gray-800 mt-1",children:[E,"ê±´"]}),e.jsx("p",{className:"text-xs text-blue-500 mt-2 font-medium",children:"í´ë¦­í•˜ì—¬ ìƒì„¸ ë‚´ì—­ ë³´ê¸° â†’"})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-100",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"ì´ ë§¤ì¶œ (ìˆ˜ìž„ë£Œ)"}),e.jsxs("p",{className:"text-3xl font-bold text-blue-600 mt-1",children:[N.toLocaleString(),"ë§Œì›"]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-100",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"ì´ ê¸°ëŒ€ ìˆ˜ìµ (ì „ì•¡)"}),e.jsxs("p",{className:"text-3xl font-bold text-green-600 mt-1",children:[v.toLocaleString(),"ë§Œì›"]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-100",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"ê³„ì•½ì¼ ëˆ„ë½"}),e.jsxs("p",{className:"text-3xl font-bold text-red-500 mt-1",children:[B,"ê±´"]}),e.jsx("p",{className:"text-xs text-red-400 mt-2",children:"ì •ì‚° ì§‘ê³„ ì œì™¸ë¨"})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-100 h-80 flex flex-col",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-700 mb-4 flex-shrink-0",children:["ì›”ë³„ ë§¤ì¶œ ì¶”ì´ (",i?"ì „ì²´":r==null?void 0:r.name,")"]}),e.jsx("div",{className:"flex-1 min-h-0 w-full",children:e.jsx(G,{width:"100%",height:"100%",children:e.jsxs(X,{data:w,children:[e.jsx(q,{strokeDasharray:"3 3",vertical:!1}),e.jsx(H,{dataKey:"name"}),e.jsx(J,{}),e.jsx(Q,{formatter:t=>[`${t.toLocaleString()}ë§Œì›`,""]}),e.jsx(I,{dataKey:"revenue",fill:"#3b82f6",name:"ë§¤ì¶œ",radius:[4,4,0,0]}),e.jsx(I,{dataKey:"commission",fill:"#10b981",name:"ì˜ˆìƒ ìˆ˜ë‹¹(Full)",radius:[4,4,0,0]})]})})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-gray-100",children:e.jsx("h3",{className:"font-bold text-gray-700",children:"ì›”ë³„ ìš”ì•½"})}),e.jsxs("table",{className:"w-full text-sm text-center",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-600 font-medium",children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-3",children:"ì›”"}),e.jsx("th",{className:"py-3",children:"ê³„ì•½ ê±´ìˆ˜"}),e.jsx("th",{className:"py-3",children:"ë§¤ì¶œ"}),e.jsx("th",{className:"py-3",children:"ìˆ˜ë‹¹ (ì˜ˆìƒ Full)"})]})}),e.jsx("tbody",{children:w.map((t,s)=>e.jsxs("tr",{className:`border-b border-gray-50 last:border-0 hover:bg-gray-50 ${l===s+1?"bg-blue-50":""}`,children:[e.jsx("td",{className:"py-3 font-medium",children:t.name}),e.jsx("td",{className:"py-3 text-gray-500",children:t.count}),e.jsx("td",{className:"py-3 text-blue-600",children:t.revenue.toLocaleString()}),e.jsx("td",{className:"py-3 text-green-600 font-bold",children:t.commission.toLocaleString()})]},s))})]})]}),e.jsxs(W,{isOpen:k,onClose:()=>u(!1),title:`${p}ë…„ ${l==="all"?"ì „ì²´":l+"ì›”"} ê³„ì•½ ë° ì •ì‚° ìƒì„¸ ë‚´ì—­`,children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left whitespace-nowrap",children:[e.jsx("thead",{className:"bg-gray-100 text-gray-700 font-bold",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2",children:"ê³„ì•½ì¼"}),e.jsx("th",{className:"px-4 py-2",children:"ê³ ê°ëª…"}),e.jsx("th",{className:"px-4 py-2",children:"ê±°ëž˜ì²˜"}),e.jsx("th",{className:"px-4 py-2",children:"ìƒíƒœ"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"ìˆ˜ìž„ë£Œ"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"ìˆ˜ë‹¹(Rule)"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:d.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-4 py-8 text-center text-gray-500",children:"í•´ë‹¹ ê¸°ê°„ì— ì™„ë£Œëœ ê³„ì•½ ê±´ì´ ì—†ìŠµë‹ˆë‹¤."})}):d.sort((t,s)=>(s.contractAt||"").localeCompare(t.contractAt||"")).map(t=>{var a;const s=f(t);return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2 text-gray-600",children:t.contractAt}),e.jsx("td",{className:"px-4 py-2 font-medium text-gray-900",children:t.customerName}),e.jsx("td",{className:"px-4 py-2 text-gray-500",children:R(t.partnerId)}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("span",{className:"px-2 py-0.5 rounded text-xs bg-gray-100 text-gray-600 border border-gray-200",children:t.status})}),e.jsxs("td",{className:"px-4 py-2 text-right text-blue-600 font-medium",children:[(a=t.contractFee)==null?void 0:a.toLocaleString(),"ë§Œì›"]}),e.jsxs("td",{className:"px-4 py-2 text-right text-green-600 font-bold",children:[s.toLocaleString(),"ë§Œì›"]})]},t.caseId)})}),d.length>0&&e.jsx("tfoot",{className:"bg-gray-50 font-bold",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:4,className:"px-4 py-2 text-center text-gray-700",children:"í•©ê³„"}),e.jsxs("td",{className:"px-4 py-2 text-right text-blue-700",children:[N.toLocaleString(),"ë§Œì›"]}),e.jsxs("td",{className:"px-4 py-2 text-right text-green-700",children:[v.toLocaleString(),"ë§Œì›"]})]})})]})}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx("button",{onClick:()=>u(!1),className:"px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 text-sm font-medium",children:"ë‹«ê¸°"})})]})]})}export{re as default};
